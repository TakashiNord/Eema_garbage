<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>кратко.Oracle+</title>
<meta name="GENERATOR" content="WinCHM">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style>
html,body { 
	/* Default Font */
	font-family: Arial, Helvetica, sans-serif;
	font-size: 11pt;
}
</style>

</head>

<body>
<P>&nbsp;</P>
<P>БД комплекса РСДУ5 может быть организована следующим образом: <BR>1. 
Односерверная конфигурация. Вся схема данных и архивы расположены на одном 
сервере. <BR>2. Двухсерверная конфигурация с выделенным сервером архивов. <BR>3. 
Двухсерверная конфигурация со Standby сервером. Вся схема данных и архивы 
расположены на одном сервере. Второй сервер находится в режиме Standby. <BR>4. 
Двухсерверная конфигурация с использованием репликации. Вся схема данных и 
архивы расположены на каждом сервере. Синхронизация данных между серверами 
происходит с использованием репликаций. <BR>5. Трехсерверная конфигурация. Два 
сервера хранят схему данных. Синхронизация данных между серверами происходит с 
использованием репликаций. На третьем сервере хранятся архивы. <BR>6. Кластерная 
конфигурация. Два сервера организованы в кластер с использованием общего 
дискового хранилища. </P>
<P>&nbsp;</P>
<P>Инструкция по установке SUSE Linux Enterprise Server 10 SP4 x64 поясняет, как 
установить операционную систему SUSE Linux Enterprise Server 10 SP4 x64.</P>
<P>1/Отметьте текущую временную зону, воспользовавшись выбором своего домашнего 
региона, либо перейдя к разделу «Дополнительно» и выбрав смещение часового пояса 
относительно GMT.<BR>Обратите также внимание на пункт «Установить системные 
часы». Из доступных вариантов необходимо остановиться на «UTC».</P>
<P>2/Размер раздела подкачки (swap) должен быть не меньше, чем удвоенный объем 
оперативной памяти сервера (можно округлять в большую сторону).<BR>Если на 
машине планируется устанавливать БДТИ, необходимо создать раздел для хранения 
файлов базы данных и подмонтировать его в /opt/oracle/oradata. Размер&nbsp; 
раздела должен быть не менее 10 ГБ. <BR>Примечание: Организация отдельного 
раздела под данные имеет смысл только для сервера БДТИ при его работе в 
1-3-серверной конфигурации, т.к. повышает надежность при хранении данных (в 
случае краха по каким-либо причинам системного раздела, данные не 
потеряются).<BR>Оставшееся место диска необходимо выделить под основной раздел, 
выбрав файловую систему ReiserFS и точку монтирования. При наличии нескольких 
жестких дисков имеет смысл организовать их в RAID-массив для повышения 
надежности системы и данных. <BR>Инструкция по установке программного RAID 
находится в документе&nbsp;&nbsp; «Установка программного RAID для SLES 
10.doc».<BR>Установка RAID<BR>Установка RAID выполняется с помощью 
инсталляционного диска SLES на этапе создания структуры разделов на дисках. 
Описание шагов по установке и конфигурации приводится из опыта работы с системой 
SLES10.<BR>Предполагается иметь в конечной конфигурации 2 раздела:<BR>* swap 
(размером 1,5*&lt;Размер оперативной памяти&gt;);<BR>* основной раздел 
(монтируется как /);<BR>Диски, на основе которых будет создан RAID, могут быть 
несимметричные, главное чтобы разделы, входящие в RAID были одинакового 
размера.<BR>1. Подготовка разделов – удаление старых разделов. В случае если 
диски были ранее размечены под использование в RAID, сначала удаляются разделы 
RAID, а затем остальные разделы.<BR>2. Создание SWAP-разделов на обоих дисках. 
Выбираем размер, ставим опцию «не форматировать», тип «RAID». Следим, чтобы 
созданные на разных дисках разделы совпадали по размеру.<BR>3. Создание основных 
разделов на обоих дисках. Выбираем размер, ставим опцию «не форматировать», тип 
«RAID». Следим, чтобы созданные на разных дисках разделы совпадали по 
размеру.<BR>4. Далее необходимо сформировать из созданных разделов RAID. 
Выбираем в пункте меню «RAID-&gt;Create RAID» создание RAID1 
(зеркалирование).<BR>* сначала для раздела SWAP выбираем пару созданных 
разделов, выбираем форматирование для SWAP, остальные опции по умолчанию; <BR>* 
для основного раздела выбираем пару созданных разделов, выбираем тип 
форматирования RAISER, точку монтирования ставим «/», остальные опции по 
умолчанию;<BR>5. В настройках «Установка загрузчика» необходимо выбрать опцию 
«Писать в MBR обоих дисков»<BR>После окончания установки и перезагрузки можно 
приступить к проверке конфигурации RAID.<BR>Замечание. Если один из дисков RAID 
на некоторое время будет отключен, то произойдет расхождение в данных и в 
дальнейшем потребуется дополнительная процедура синхронизации для восстановления 
RAID.<BR>Проверка конфигурации RAID<BR>Для конфигурирования и администрирования 
программного RAID существуют программные пакеты, о которых можно узнать из 
дополнительных источников. <BR>В настоящей инструкции приведены основные 
команды, которыми практически всегда можно воспользоваться без установки 
дополнительного ПО.<BR>Вывод информации по файловым системам:<BR>df –h<BR>Вывод 
информации по разделам диска:<BR>fdisk –l<BR>Вывод информации по разделам, 
включенным в RAID-массив:<BR>cat /proc/mdstat<BR>Примерный вывод информации для 
двух разделов, работающих в RAID.<BR>md1: active&nbsp;&nbsp;&nbsp; 
raid1&nbsp;&nbsp; sda2[0]<BR>&nbsp;&nbsp;&nbsp;&nbsp; XXX blocks&nbsp;&nbsp; 
[2/1]&nbsp; [U_]&nbsp; <BR>md0: active&nbsp;&nbsp;&nbsp; raid1&nbsp;&nbsp; 
sda1[0] sdb1[1]<BR>&nbsp;&nbsp;&nbsp;&nbsp; XXX blocks&nbsp;&nbsp; [2/2]&nbsp; 
[UU]<BR>В данном примере раздел md1 состоит из 2-ух объединенных разделов, и он 
в нерабочем состоянии. Раздел md0 – также состоит из двух разделов (sda1 и sdb1) 
- исправен. Возможная причина такого состояния – неисправность одного из дисков 
RAID, либо рассинхронизация в данных.<BR>Замена диска в RAID. Выполнение 
синхронизации дисков.<BR>Простейшая команда, которая позволит включить раздел в 
RAID:<BR>mdadm &lt;имя RAID-раздела&gt; --add &lt;имя 
раздела&gt;<BR>Например,<BR>mdadm /dev/md0 --add /dev/sdb2<BR>После выполнения 
данной команды, должно появиться диагностическое сообщение типа:<BR>re-added 
/dev/sdb2<BR>За этим последует выполнение синхронизации включенного раздела – 
копирование блоков данных с раздела-источника, который уже был включен в 
RAID.<BR>За этим процессом можно будет наблюдать с помощью команды:<BR>watch cat 
/proc/mdstat<BR>С помощью описанной команды можно выполнить синхронизацию дисков 
в случае расхождения данных на дисках.<BR>Заметим, что процесс синхронизации с 
помощью подобной команды отнимает много времени. <BR>Использование других утилит 
возможно, но потребуется дополнительная установка пакетов администрирования 
RAID, и в данном документе они не описываются. Например, возможно использование 
команды ckraid.<BR>Программное обеспечение<BR>ОС SLES содержит большое число 
программных пакетов для различных целей. <BR>Системные пакеты<BR>Так как было бы 
обременительно выбирать необходимые пакеты один за другим, SLES предлагает по 
умолчанию оптимальный набор пакетов. Выберите «Программное обеспечение» в окне 
предложения, чтобы открыть окно, которое предлагает выбор наборов пакетов. 
<BR>Следует выбрать следующие наборы пакетов:<BR>* Server Base System<BR>* 
Common Code Base<BR>* High Availability<BR>* 32Bit Runtime Environment<BR>* 
Documentation<BR>* Gnome Desktop<BR>* X Window System<BR>* File Server<BR>* 
Oracle Base Server<BR>* C/C++ Compiler and Tools<BR>Необходимо проверить, что в 
установку включены следующие пакеты: <BR>*&nbsp; mc<BR>* vsftpd<BR>* 
openssh<BR>* openmotif<BR>* libaio<BR>* libaio-devel<BR>* make<BR>* gcc<BR>* 
gcc-c++<BR>* cpp<BR>*&nbsp; glibc<BR>* glibc-devel<BR>* glib2<BR>* 
glib2-devel<BR>* libstdc++<BR>* compat<BR>* orarun<BR>* xntp<BR>* unrar<BR>* 
unzip<BR>* nmap<BR>Если конфигурируемый хост будет использоваться под сервер 
БДТИ, дополнительно потребуется установить пакеты: <BR>* bind&nbsp;&nbsp;&nbsp; 
и&nbsp; binutils<BR>* tcl-devel<BR>* db1</P>
<P>Конфигурирование сети<BR>Конфигурирование сети необходимо делать для внешней 
(связь машины с внешними устройствами) и внутренней сети (связь машин в 
кластере, если таковая конфигурация предполагается). Далее приведен пример 
конфигурирования внешней сети. <BR>Нажмите на ссылку «Включен» напротив пункта 
«Брандмауэр» для отключения последнего. <BR>Прокрутите список настроек в главном 
окне и выберете пункт «Удалённое администрирование», в открывшемся окне выберите 
пункт «Разрешить удалённое администрирование» и нажмите кнопку «Завершить», для 
разрешения доступа через протокол VNC.<BR>При выборе «Cетевые интерфейсы» будет 
выведено конфигурационное окно, в котором будут перечислены сетевые карты, 
определенные во время установки системы<BR>ВНИМАНИЕ. Избегайте использования 
домена .local, поскольку в дальнейшем возможны ошибки при разрешении имен хостов 
в такой сети. Если по какой-то причине вы выбрали подобное название домена, 
решить проблемы с разрешением имен (в ОС SLES) поможет прописывание параметра 
mdns off в системном конфигурационном файле /etc/host.conf<BR>Также необходимо 
задать шлюз по умолчанию – для этого нужно нажать кнопку «Маршрутизация» и в 
появившемся окне ввести адрес в поле «Шлюз по умолчанию».<BR>Способ управления 
учетной информацией пользователя<BR>Локальный. Администрирование пользователей 
осуществляется локально. Информация о пользователях хранится на компьютере в 
файле /etc/passwd.<BR>LDAP. Администрирование пользователей осуществляется с 
помощью LDAP сервера.<BR>NIS. Администрирование пользователей осуществляется с 
помощью NIS сервера.<BR>Домен Windows. Авторизация SMB обычно используется в 
смешанных системах Linux и Windows.<BR>Выберите локальную идентификацию.</P>
<P>Конфигурирование аппаратных средств<BR>Поставите галочку напротив пункта 
«Отключить ZMD сервис» и нажмите кнопку «Завершить»<BR>Настройка и запуск 
FTP-сервера<BR>Из файла /etc/ftpusers удалите имя пользователя oracle и root 
(или иных пользователей, которые будут обращаться к серверу по FTP). <BR>В файле 
/etc/vsftpd.conf следует изменить следующие 
параметры:<BR>CHROOT_LOCAL_USER=NO<BR>LOCAL_ENABLE=YES<BR>WRITE_ENABLE=YES<BR>ANONYMOUS_ENABLE=NO<BR>LISTEN=NO<BR>Выберите 
пункт YaST в главном меню рабочего стола, далее перейдите к «Сетевые службы ? 
Сетевые службы (xinetd)» и установите состояние «Вкл.» для службы ftp 
(/usr/sbin/vsftpd).</P>
<P>Запуск FTP сервера можно также осуществить командами:<BR>* регистрация старта 
службы на 3 и 5 уровнях загрузки ОС<BR>chkconfig vsftpd on --level 35 <BR>* 
запуск сервера FTP<BR>service vsftpd start.<BR>Настройка SSH<BR>Описанные ниже 
действия необходимо выполнить для всех пользователей, для которых планируется 
удаленный вход в систему.<BR>1. В домашнем каталоге создать директорию .ssh. 
<BR>2. Аутентификация пользователей будет производиться по их публичному ключу. 
Поэтому необходимо сгенерировать пару ключей: открытый и закрытый (тип 
шифрования RSA). Делается это с помощью команды:<BR>ssh-keygen -t rsa<BR>Во 
время выполнения команды запрашивается ввод имени файла секретного ключа – в 
этом случае ставить предлагаемое по умолчанию ~/.ssh/id_rsa (просто нажать 
enter). Затем надо ввести пароль для шифрования секретного ключа. По этому 
паролю будет осуществляться вход пользователя в систему по SSH. При типовой 
настройке обычно используется пустой пароль (следует нажать клавишу Enter на 
предложение ввода пароля).<BR>3. Запустить сервер ssh, если он еще не 
запущен:<BR>/etc/init.d/sshd start<BR>4. Проверить автозапуск ssh на уровнях 3 и 
5. В программе YaSt выбрать раздел «Система -&gt; Системные службы 
(Runlevel)»<BR>Настройка синхронизации времени<BR>Прежде всего, проверьте, что 
служба ntp сконфигурирована для автоматического запуска при старте системы. Для 
этого запустите конфигурационную утилиту YaSt и выберите раздел «Система -&gt; 
Системные службы (Runlevel)». <BR>Далее, найдя в появившемся списке системных 
сервисов службу ntp, необходимо установить для нее состояние 
«Включить».<BR>Нажатием кнопки “Завершить” вы применяете конфигурацию, 
после&nbsp; чего можно закрыть программу.<BR>1. В файле /etc/ntp.conf необходимо 
вписать IP адрес сервера, с которым требуется проводить синхронизацию:<BR>## 
Outside source of synchronized time<BR>Server 
XX.XX.XX.XX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
<BR># IP address of server<BR>При необходимости на разных строках можно 
перечислить несколько источников синхронизации.<BR>2. Следующей командой можно 
установить на машине время с сервера синхронизации:<BR>ntpdate 
XX.XX.XX.XX<BR>Этот шаг можно пропустить, но учтите, что синхронизация времени 
может занять большее время.<BR>3. Перезапустите демон NTP для точной коррекции 
времени с помощью команды:<BR>/etc/init.d/ntp restart</P>
<P>Результат должен быть следующим:<BR>Shutting down network time protocol 
daemon (NTPD)&nbsp;&nbsp; done<BR>Try to get initial date and time via NTP from 
XXX&nbsp;&nbsp; done<BR>Starting network time protocol daemon 
(NTPD)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; done</P>
<P>С лог файлом службы ntp можно ознакомиться 
здесь:<BR>/var/log/ntp<BR>Примечание. Частота синхронизации зависит от того, 
насколько быстро «убегают» системные часы относительно источника точного времени 
и это определяется в ходе работы сервиса накоплением статистики. Точность 
зависит от системных часов. Сам протокол ntp позволяет корректировать часы с 
точностью до 1 микросекунды. Погрешность зависит от точности, от наличия в 
цепочке синхронизации промежуточных серверов, от времени последней синхронизации 
от задержек в сети и т.п. Чтобы посмотреть текущее состояние синхронизации, 
можно от имени пользователя root воспользоваться командой:<BR>ntpq -np 
<BR>Результат может быть представлен следующим 
образом:<BR>&nbsp;remote&nbsp;&nbsp; refid&nbsp;&nbsp;&nbsp; st&nbsp; t&nbsp; 
when poll reach delay&nbsp; offset 
jitter<BR>==============================================================<BR>&nbsp;LOCAL(0) 
LOCAL(0) 10&nbsp; l&nbsp; 47&nbsp;&nbsp; 64&nbsp;&nbsp; 377&nbsp;&nbsp; 
0.000&nbsp; 0.000&nbsp; 0.001<BR>*XXX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOCAL(0) 
11&nbsp; u&nbsp; 228&nbsp; 256&nbsp; 377&nbsp;&nbsp; 0.456&nbsp; 0.641&nbsp; 
2.331</P>
<P>Звездочкой отмечен выбранный источник для синхронизации.<BR>Расшифровка полей 
в таблице:<BR>offset – разница во времени между локальным и удаленным сервером, 
мс. Одно из наиболее важных значений. Чем оно меньше - тем точнее 
время.<BR>reach – шестнадцатеричное представление массива из 8-ми бит, в котором 
фиксируется 8 последних попыток синхронизации. Если попытка была успешной, то 
устанавливается 1. Значение 377 говорит о том, что все 8 последних попыток были 
удачными.<BR>refid – показывает откуда этот сервер берет время. Тут может быть 
имя (или IP) другого сервера, GPS, LOCAL (локальные часы сервера) и т. 
п.<BR>remote – имя удаленного ntp сервера.<BR>when – сколько секунд назад был 
получен последний пакет от данного сервера.<BR>poll – период опроса сервера, 
секунд.<BR>delay – вычисленная задержка ответов от сервера (RTT) в 
миллисекундах.<BR>jitter – дисперсия отклонения удаленных часов относительно 
локальных, вычисленная по нескольким последним запросам, мс. Чем меньше это 
значение - тем более точная возможно синхронизация.<BR>Важно!<BR>1. 
команда&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ntpdate -d 192.168.110.4&nbsp;&nbsp;&nbsp; 
- не работает&nbsp; на операционной системе&nbsp; SLES 11 SP3<BR>2. где 
установлен SLES10, команда ntpdate проходит нормально.<BR>3. для ручной 
синхронизации времени в SLES 11 SP3 необходимо использовать 
команды:<BR>&nbsp;&nbsp;&nbsp; sntp -V -P no -r 
192.168.110.4<BR>либо<BR>&nbsp;&nbsp; rcntp ntptimeset 192.168.110.4<BR>4. 
Синхронизация времени на всех серверах комплекса РСДУ под ОС Linux осуществляет 
служба ntp в автоматическом режиме, она прописана в автозагрузке серверов, 
поэтому в ручной синхронизации времени необходимости нет. Выполнить проверку 
синхронизации времени можно&nbsp; командой:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ntpq 
-np</P>
<P>Инструкция по установке Oracle 10g R2 на SLES 10 SP4 x64 поясняет, как 
установить СУБД Oracle в односерверной конфигурации для&nbsp; операционной 
системы SLES 10.<BR>Условия инсталляции<BR>В качестве аппаратных средств 
используется выделенный сервер или виртуальная машина с установленной OC SLES 
SP4 x64. На сервере должна быть установлена графическая оболочка.<BR>Для 
проведения инсталляции необходимо наличие файлов дистрибутивов ПО СУБД Oracle 
10g и кумулятивного обновления (патчсета) Oracle до версии 10.2.0.5:<BR>* 
10201_database_linux_x86_64.cpio.gz<BR>* p8202632_10205_Linux-x86-64.zip</P>
<P>Устанавливается ПО СУБД версии Standart Edition с размещением файлов БД в 
файловой системе.<BR>Домашний каталог для размещения ПО СУБД – 
/opt/oracle.<BR>Каталог для размещения файлов БД – 
/opt/oracle/oradata.<BR>Следует выставить правильные права на каталог для 
размещения файлов БД (выполняется с правами пользователя root):<BR>chown -R 
oracle:oinstall /opt/oracle/oradata<BR>chmod -R 775 
/opt/oracle/oradata<BR>Проверка назначенного IP адреса <BR>В файле /etc/hosts 
необходимо проверить, что задан актуальный IP адрес и доменное имя вашего 
сервера, например:<BR>192.168.50.1&nbsp; linux.ema.ru&nbsp; linux<BR>Проверьте 
также, что задан и не закомментирован адрес локального хоста:<BR>127.0.0.1&nbsp; 
localhost<BR>При необходимости отредактируйте файл (может быть выполнено от 
имени пользователя root).</P>
<P>Настройка пользователя oracle <BR>Дистрибутив SLES 10 SP4 предоставляет пакет 
orarun для автоматизации большей части предустановочных задач для развертывания 
СУБД Oracle. Указанные ниже действия необходимо выполнять от имени пользователя 
root.<BR>1. Если пакет orarun установлен в системе, то автоматически было 
выполнено создание&nbsp; пользователя oracle, создание необходимых групп и 
прочие предварительные настройки (см. Приложение 1).<BR>2. После создания 
пользователя oracle его учетная запись заблокирована. Для разблокировки 
необходимо выполнить:<BR>2.1. Войти в систему как пользователь root.<BR>2.2. В 
файле /etc/passwd изменить оболочку (shell) для пользователя oracle c 
«/bin/false» на «/bin/bash».<BR>2.3. Установить новый пароль для пользователя 
oracle с помощью команды:<BR>passwd oracle<BR>Эти же действия могут быть 
выполнены в программе YaST. Для этого необходимо перейти в раздел «Пользователи 
и безопасность» / «Управление пользователями», далее нажать кнопку «Задать 
фильтр» и выбрать пункт «Системные пользователи», где в списке будет доступна 
для редактирования учетная запись Oracle (рис. 1 и 2).</P>
<P>3. По завершении редактирования пользователя проверьте учетную информацию 
пользователя oracle, выполнив команду:<BR>id oracle<BR>Результат команды должен 
быть примерно следующий (идентификаторы пользователя или групп могут быть 
другими, но перечень групп должен совпадать):<BR>uid=102(oracle) 
gid=103(oinstall) <BR>groups=6(disk),103(oinstall),104(dba)</P>
<P>4. Для изменения переменных окружения Oracle по умолчанию, установленных 
пакетом orarun в файле «/etc/profile.d/oracle.sh»<BR>4.1. В файле 
«/etc/profile.d/oracle.sh» измените Oracle home directory, отредактировав 
переменную окружения ORACLE_HOME, а также&nbsp; исправьте переменную 
ORACLE_SID:<BR>ORACLE_HOME=$ORACLE_BASE/product/10g<BR>ORACLE_SID=rsdu<BR>Предупреждение. 
В процессе создания БД Oracle Installer выведет диалог ввода имени базы данных. 
Это имя должно совпадать с переменной окружения ORACLE_SID для предотвращения 
дальнейших проблем.<BR>4.2. Добавьте в файл «/etc/profile.d/oracle.sh» (или 
исправьте, если они имеются) переменные, приведенные 
ниже:<BR>NLS_LANG=RUSSIAN_CIS.CL8MSWIN1251;export 
NLS_LANG<BR>NLS_NUMERIC_CHARACTERS=".,";export 
NLS_NUMERIC_CHARACTERS<BR>NLS_DATE_FORMAT='dd.mm.yyyy hh24:mi:ss';export 
NLS_DATE_FORMAT<BR>4.3. В заключение, в&nbsp; файле «/etc/profile.d/oracle.sh» 
необходимо закомментировать строку в начале файла (поставив в начале строки 
символ «#» )<BR>if [ `id -un` == "oracle" ]; then<BR>и в конце файла последнюю 
строку <BR>fi<BR>Примечание. Измененный файл oracle.sh вступает в силу при 
следующем входе пользователя в операционную систему. Поэтому, после 
редактирования файла необходимо закрыть сеанс (выйти из терминала) и открыть 
новое соединение.<BR>Создание пользователей и групп (на всех узлах кластера) 
<BR>Создайте группу oinstall с помощью команды: groupadd –g 501 oinstall 
<BR>Создайте группу dba с помощью команды: groupadd –g 500 dba <BR>Создайте 
пользователя oracle с помощью команды: <BR>&nbsp;&nbsp; useradd –g oinstall –G 
dba oracle <BR>&nbsp;&nbsp; mkdir -p /home/oracle /ocfs <BR>&nbsp;&nbsp; useradd 
-d /home/oracle -g oinstall -G dba -s /bin/bash oracle <BR>&nbsp;&nbsp; chown -R 
oracle:dba /home/oracle <BR>&nbsp;&nbsp; passwd oracle <BR>&nbsp;&nbsp; chown –R 
oracle:dba /ocfsl <BR>Установите пароль для пользователя oracle с помощью 
команды: <BR>passwd oracle</P>
<P><BR>Для хранения файлов данных БД рекомендуется создать отдельный каталог 
/db. В нем, в зависимости от количества имеющихся дисков, можно создавать 
подкаталоги /db/db1, /db/db2 и т.д. <BR>В подкаталоги можно монтировать 
существующие диски и разделы дисков, выделенные под файлы БД. <BR>Рекомендуемая 
структура подкаталогов db1, db2 и т.д.: <BR>datafile – для хранения самих файлов 
данных; <BR>ctrl – для хранения управляющих файлов; <BR>redo – для хранения 
файлов отката. <BR>В случае, если под БД выделен один диск хотя бы для одной 
директории (например, db2), сделать link подкаталогов ctrl и redo на другом 
диске (например, на диске, где расположена ОС) или подмонтировать раздел другого 
диска.</P>
<P>&nbsp;</P>
<P>Установка Oracle 10g R2 <BR>Предупреждение. Установка должна производиться с 
правами пользователя oracle. Далее по тексту везде, где не указано иное, команды 
необходимо выполнять под учетной записью oracle.<BR>1. Скопировать на сервер БД 
файл дистрибутив ПО СУБД 10201_database_linux_x86_64.cpio.gz<BR>Файл должен 
принадлежать пользователю oracle (проверка может быть выполнена с помощью 
команды «ls -ls»), в противном случае необходимо изменить для файла владельца 
командой (выполняется под пользователем root):<BR>chown oracle:oinstall 
10201_database_linux_x86_64.cpio.gz<BR>2. Распаковать архив дистрибутива на 
сервере с помощью команд. <BR>gunzip 10201_database_linux_x86_64.cpio.gz<BR>cpio 
-idmv &lt; 10201_database_linux_x86_64.cpio<BR>3. Войти в графическую оболочку 
на сервере как пользователь oracle (непосредственно на сервере либо с 
использованием специализированной программы типа VNC).<BR>4. Перейти в папку 
database с распакованным дистрибутивом ПО СУБД и запустить Oracle Universal 
Installer c опцией игнорирования системных требований:<BR>./runInstaller 
-ignoreSysPrereqs<BR>Примечание: до запуска инсталлятора рекомендуется в этом же 
окне выполнить команду env | grep ORA для проверки текущих установленных 
переменных окружения.<BR>Oracle Installer последовательно предложит несколько 
диалоговых окон для сбора необходимой для инсталляции информации. Необходимо 
ответить на предложенные вопросы, продвигаясь к следующему окну нажатием кнопки 
Next.<BR>В диалоге «Specify Inventory directory and credentials» будет 
предложено указать полный путь к каталогу реестра ПО Oracle (Inventory 
directory). Значение по умолчанию – «$ORACLE_BASE/oraInventory», где 
$ORACLE_BASE это значение, которое указано в переменной окружения ORACLE_BASE. 
Кроме этого необходимо указать группу, которой будут даны права на работу с 
реестром - проверьте, что указана группа «oinstall»</P>
<P>Примечание. Диалог «Specify Inventory directory and credentials» появляется 
только при первой установке программного обеспечения Oracle на хосте.<BR>В 
следующем окне выбора типа инсталляции «Select Installation Type» сначала 
необходимо проверить, что в составе языков («Product Languages») присутствует 
русский. Кроме того, должен быть задан тип установки «Standard Edition».</P>
<P>В окне Specify File Locations на вопрос, куда устанавливать ПО СУБД, укажите 
в поле «Name», что это HOME для базы данных (OraDb10g_home1) и в поле «Path» 
введите путь, указанный ранее для переменной $ORACLE_HOME в файле 
«/etc/profile.d/ oracle.sh».<BR>Значение поля Path здесь указывает каталог, в 
который будет произведена установка программного обеспечения Oracle.<BR>На 
следующем шаге программа установки выполняет проверку конфигурации сервера (рис. 
6). Отметьте варианты, которые не исполнялись («Not executed» в поле Status). 
Все стадии проверки должны быть успешны, кроме предупреждения о том, что 
операционная система не сертифицирована для 10g: «Problem: Oracle Database 10g 
is not certified on the current operating system». Это предупреждение можно 
игнорировать.</P>
<P>В следующем окне «Select Configuration Option»&nbsp; предлагается выбрать 
дополнительные действия после инсталляции: сразу создать базу данных или 
сконфигурировать ASM. Необходимо отказаться от предложенных опций, выбрав 
переключатель «Установить только ПО» (Software only), т.к. прежде чем создавать 
БД необходимо выполнить обновление ПО Oracle до текущей рабочей версии 
(10.2.0.5).</P>
<P>На этом сбор информации для инсталляции завершен. Появляется окно «Summary» 
(рис. 9) c полной информацией о выбранных продуктах, которые будут установлены 
на сервере. Убедитесь в том, что устанавливается версия «Standart Edition» и что 
был добавлен русский язык, так как иначе БД будет создана без поддержки русского 
языка.&nbsp; В случае необходимости воспользуйтесь кнопкой «Back».</P>
<P>В заключение для завершения инсталляции будет предложено исполнить под 
пользователем root конфигурационные скрипты (рис. 11). Необходимо 
последовательно выполнить перечисленные скрипты в новом окне терминала под 
пользователем root. <BR>su - 
root<BR>/opt/oracle/oraInventory/orainstRoot.sh<BR>/opt/oracle/product/10g/root.sh<BR>Примечание. 
Запрос на исполнение скрипта «/opt/oracle/oraInventory/ orainstRoot.sh» 
появляется только при первой установке программного обеспечения СУБД Oracle на 
сервере.</P>
<P>Когда скрипты предлагают что-то перезаписать, необходимо соглашаться со 
значениями по умолчанию. При этом обратите внимание, что иногда надо нажать 
клавишу «Enter», а иногда набрать на клавиатуре «y» («yes»).<BR>Установка 
обновления 10.2.0.5<BR>Установка кумулятивного обновления (патчсета) 
производится также&nbsp; с правами пользователя oracle.<BR>1. Скопировать на 
сервер БД дистрибутив патчсета p8202632_10205_Linux-x86-64.zip <BR>Файл должен 
принадлежать пользователю oracle (проверка может быть выполнена с помощью 
команды «ls -ls»). В противном случае, необходимо изменить ему владельца 
командой (команда выполняется с правами пользователя root):<BR>chown 
oracle:oinstall p8202632_10205_Linux-x86-64.zip<BR>2. Распаковать архив 
дистрибутива на сервере. <BR>unzip p8202632_10205_Linux-x86-64.zip<BR>3. Войти в 
графическую оболочку на сервере как пользователь oracle.<BR>4. Перейти в папку с 
распакованным дистрибутивом патчсета (папка Disk1). Запустить Oracle Universal 
Installer:<BR>./runInstaller<BR>Аналогично процессу инсталляции базовой версии 
ПО СУБД Oracle 10.2.0.1, инсталлятор последовательно предложит несколько 
диалоговых окон, описанных ниже.<BR>В окне «Specify Home Details» должен быть 
указан обновляемый HOME (рис. 12). Поле «Path» указывает папку, куда уже 
инсталлирована базовая версия ПО СУБД 10.2.0.1, которое будет обновлено до 
версии 10.2.0.5.</P>
<P>Пакет orarun, входящий в поставку SUSE Linux 10 устанавливает необходимые 
переменные окружения Oracle, такие как ORACLE_HOME, PATH; устанавливает 
рекомендованные параметры ядра, например, SHMMAX, и предоставляет механизм 
автоматического запуска и остановки компонентов Oracle при загрузке и остановки 
операционной системы.<BR>Что делает пакет orarun?<BR>* создает пользователя 
oracle&nbsp; и группы dba, oinstall с фиксированными id;<BR>* создает несколько 
символьных ссылок для некоторых приложений Oracle;<BR>* создает все 255 
возможных raw устройств в каталоге /dev/raw;<BR>* устанавливает скрипты по 
автоматическому запуску и остановке компонентов Oracle и Oracle Cluster File 
System (OCFS) (кластерная файловая система для Oracle RAC).</P>
<P>Oracle Installer предоставляет возможность по удалению установленных 
продуктов, но иногда, по разным причинам, установка может быть выполнена не 
полностью, и потребуется запускать новую установку. Далее приведены несколько 
шагов для быстрой и «грубой» очистки системы:<BR>1. Удалить 
файлы:<BR>/usr/local/bin/coraenv<BR>/usr/local/bin/dbhome<BR>/usr/local/bin/oraenv<BR>/etc/oratab<BR>/etc/oraInst.loc<BR>2. 
Удалить каталог:<BR>/etc/oracle<BR>3. Удалить все файлы&nbsp; и каталоги, 
созданные Oracle Installer в /opt/oracle (Install Directory).</P>
<P>Особенности создания БД<BR>При создании БД необходимо: <BR>? Сделать 
мультиплексирование контрольных файлов. Должно быть не менее двух контрольных 
файлов, расположенных в директориях /db/db1/ctrl и /db/db2/ctrl. Эти директории 
должны быть размещены на различных дисках. <BR>? Сделать мультиплексирование 
файлов отката. Должны быть созданы группы отката, в каждой группе не менее двух 
файлов отката, расположенных в директориях /db/db1/redo и /db/db2/redo. Эти 
директории должны быть размещены на различных дисках. </P>
<P>Разнесение по различным директориям файлов данных зависит от применяемой 
конфигурации (выделен или не выделен сервер архивов), количества дисков под 
файлы данных БД, наличия или отсутствия средств резервирования дисков 
(зеркалирование, RAID). <BR>При установке большинство предлагаемых параметров 
можно применять по умолчанию. Рекомендуемые изменения: <BR>max_enabled_roles –не 
менее 148 (в Oracle 10g данное значение стоит по умолчанию ) <BR>db_files – не 
менее 200 <BR>db_block_size – в зависимости от настроек ОС и типа сервера: для 
сервера архивов от 8192 до 32768, для сервера БД ТИ (в том числе и совмещенного) 
– от 4096 до 8192 (по умолчанию 8192) <BR>db_cache_size – выставляется в 
зависимости от количества ОЗУ <BR>db_16k_cache_size, db_32k_cache_size – 
необходимо установить для сервера БД ТИ значение от 0,5 до 1 от значения 
db_cache_size. В этом случае возможно будет создавать табличные пространства с 
большим значением блока. Применяется для табличных пространств с журналами и 
архивами (в случае совмещенного сервера) <BR>open_cursors – не менее 200, 
рекомендуется 300 <BR>processes – в зависимости от количества пользователей, 
рекомендуется 300 <BR>sessions – в зависимости от количества пользователей, 
обычно не менее 170 (по умолчанию) <BR>Обычно не применяется MTS.</P>
<P>Создание БД выполняется с помощью программы-ассистента dbca в графической 
оболочке сервера БД с предустановленным ПО СУБД Oracle. <BR>Ниже описаны шаги по 
созданию новой БД. Все действия должны выполняться под пользователем oracle, 
если не указано иное.<BR>1/Для начала установки из командной строки необходимо 
выполнить команду:<BR>dbca<BR>2/На втором этапе программа предлагает выбрать 
шаблон, по которому будет создана БД (рис.2). Здесь следует выбрать вариант 
"Custom Database" для исключения установки неиспользуемых в БДТИ РСДУ2&nbsp; 
опций Oracle.&nbsp; <BR>Примечание. Из типовых шаблонов для БДТИ РСДУ2 наиболее 
подходящий вариант – "General Purpose". Он также может быть выбран&nbsp; как 
вариант установки. Однако, вариант "Custom Database" с выключением ненужных 
опций более предпочтителен.<BR>3/На следующем шаге следует задать имя и SID 
новой БД. Типовой SID для БДТИ РСДУ2 – это "rsdu". SID должен быть уникальным в 
пределах одного сервера.&nbsp; Будьте внимательны, если настраивается тестовый 
сервер, и на нем уже присутствуют другие экземпляры БД, то вместо типового 
названия SID необходимо использовать другое подходящее по смыслу наименование. 
При этом имя SID должно быть не длиннее 8 символов. Для сервера с единственной 
БД на хосте название SID должно совпадать с переменной окружения 
$ORACLE_SID.<BR>Внимание. Регистр букв для SID имеет значение, поскольку на 
основе этого имени будут созданы папки и файлы в ОС Linux.<BR>Для поля "Global 
Database Name" обычно указывается имя с доменом сети предприятия. Это имя также 
должно быть уникально в пределах сети предприятия и однозначно идентифицировать 
конкретную БД.<BR>4/На следующей форме необходимо отключить опцию «Configure The 
Database with Enterprise Manager». При необходимости, поддержку ЕМ можно будет 
создать вручную, пользуясь соответствующей инструкцией «Активация консоли 
EM».<BR>Примечание. Если опцию «Configure The Database with Enterprise Manager» 
не отключать, то работа программы после создания БД заканчивается с ошибкой. При 
этом БД создастся, но EM будет неработоспособный.<BR>5/В окне задания паролей 
системных пользователей следует задать единый типовой пароль для БД РСДУ2 
(например, «passme»).<BR>6/Для механизма хранения и управления файлами БД 
следует выбрать&nbsp; переключатель "File System".<BR>В окне "Specify locations 
for the Database files" могут быть выбраны следующие варианты:<BR>* Use Database 
File Locations from Template – файлы БД будут созданы по шаблону в каталоге по 
умолчанию<BR>/opt/oracle/oradata/&lt;SID&gt;<BR>* Use Common Locations for All 
Database Files – здесь может быть указано конкретное название папки, где следует 
разместить файлы БД;<BR>* Use Oracle-Managed file – также может быть указано 
название папки, но при этом Oracle сам будет давать названия файлам БД.<BR>Как 
правило, для создания типовой БДТИ РСДУ2 в зависимости от конфигурации файловой 
системы сервера используется один из первых двух вариантов указания размещения 
файлов БД.<BR>7/Следующий шаг предлагает указать расположение области Flash 
recovery Area – директорию, где будут храниться файлы журналов повтора 
транзакций&nbsp; после включения опции архивирования журналов. Саму опцию&nbsp; 
архивирования ARCHIVELOG (переключатель Enable Archiving) на данном этапе 
включать не нужно, даже если в дальнейшем предполагается ее использование (для 
промышленных БД&nbsp; использование обязательно). Это общее правило, так как на 
этапе загрузки БД из-за значительных объемов данных&nbsp; будет генерироваться 
большой объем журналов повтора и потребуется постоянное наблюдение за доступным 
местом на диске и выполнение операций по его очистке.<BR>8/Следующий шаг – выбор 
включаемых в создаваемый экземпляр компонентов СУБД. Окно появляется, если 
только на начальном этапе выбран вариант создания БД не по конкретному шаблону, 
а вариант&nbsp; "Custom Database". В этом диалоге необходимо отключить все 
предлагаемые опции, кроме "Enterprise Manager Repository" (рис.9). Стандартные 
компоненты (кнопка "Standart Database Components") нужно оставить как есть, по 
умолчанию (то есть все включены). Пользовательских скриптов (закладка "Custom 
Scripts") на данном этапе нет.<BR>9/Следующий диалог позволяет на 4 закладках 
задать основные параметры новой БД:<BR>* Memory – выделяемая память, доступная 
для использования экземпляру БД. Устанавливается в зависимости от физической 
памяти сервера, но не более 1560МБ для SGA (общая совместно используемая 
память).<BR>Рекомендуется использовать (или принимать во внимание) метод 
распределения памяти по переключателю "Typical" (до 60% от оперативной памяти 
сервера). Минимальная граница для SGA – 170-250MБ, но рекомендуется выставлять 
не менее 600МБ. Для PGA (память для пользовательских процессов) обычно 
выставляется значение приблизительно в 1/3 от указанного значения SGA, то есть 
от 200 до 500 МБ.<BR>Sizing – задается размер блока БД (зависит от ОС, по 
умолчанию 8 Кб) и количество одновременно работающих с БД пользовательских 
процессов (необходимо установить значение "Processes" не менее 
300).<BR>Character Sets – особо важный этап конфигурирования – страница 
установки языковых кодировок БД. Будьте внимательны: при неправильной установке 
кодировки БД может быть невозможным отображение русских символов. Следует 
установить кодировку CL8MSWIN1251 (выбрать из списка). Для поля "National 
Character Set" остается кодировка по умолчанию – AL16UTF16, для "Default 
Language" и "Default Date Format" нужно выбрать соответственно русский язык и 
страну Россия.<BR>На закладке "Connection Mode" выбирается значение по умолчанию 
– "Dedicated Server Mode" – режим выделенного сервера. Таким образом, каждый 
пользовательский процесс будет обрабатываться отдельным серверным процессом. 
Поскольку БДТИ РСДУ2 работает с небольшим, ограниченным числом пользователей в 
выделенной сети, это оптимальный выбор<BR>10/Следующее диалоговое окно является 
завершающим. Здесь имеется кнопка "Finish", после нажатия на которую уже 
начнется процесс создания БД. Предварительно рекомендуется отметить опцию 
"Generate Database Creation Scripts". Можно также сохранить шаблон БД, но это 
является необязательной опцией.<BR>Создание прослушивающего процесса БД 
(листенера)<BR>Для того чтобы новая созданная БД могла принимать и обрабатывать 
запросы клиентов, для нее на сервере СУБД также должен быть создан 
прослушивающий процесс (листенер), отслеживающий обращения клиентских 
сессий.<BR>Самым простым способом создания листенера является использование 
программы netca. В этом случае следует запустить программу netca из командной 
строки на сервере БД в графической оболочке под пользователем oracle, в 
появившемся окне программы необходимо выбрать переключатель "Listener 
configuration" и далее&nbsp; создать листенер c типовыми установками по 
умолчанию. Программа создаст типовой конфигурационный файл листенера и выполнит 
его запуск.<BR>Выполнить создание листенера можно также вручную. Суть процесса 
заключается в создании конфигурационного файла листенера listener.ora, который 
располагается в папке $ORACLE_HOME/network/admin (на эту папку также указывает 
переменная среды $TNS_ADMIN), после чего запускается процесс листенера, который 
использует этот конфигурационный файл.<BR>Для редактирования файла необходимо 
зайти в каталог $ORACLE_HOME/network/admin и создать (или отредактировать) файл 
listener.ora со следующим содержанием: <BR>LISTENER =<BR>&nbsp; 
(DESCRIPTION_LIST =<BR>&nbsp;&nbsp;&nbsp; (DESCRIPTION 
=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (ADDRESS = (PROTOCOL = IPC)(KEY = 
EXTPROC1))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (ADDRESS = (PROTOCOL = TCP)(HOST = 
rsdudb)(PORT = 1521))<BR>&nbsp;&nbsp;&nbsp; )<BR>&nbsp; ) </P>
<P>SID_LIST_LISTENER =<BR>&nbsp; (SID_LIST =<BR>&nbsp;&nbsp;&nbsp; (SID_DESC 
=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SID_NAME = 
PLSExtProc)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (ORACLE_HOME = 
/opt/oracle/product/10g)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (PROGRAM = 
extproc)<BR>&nbsp;&nbsp;&nbsp; )<BR>&nbsp; )</P>
<P>Здесь зависимые от конкретного сервера параметры:<BR>* (HOST = rsdudb) – имя 
хоста БД как оно прописано в файле /etc/hosts, допускается указание IP-адреса 
хоста БД;<BR>* (PORT = 1521) – номер порта для прослушивания запросов, 1521 
-&nbsp; значение по умолчанию, его и используем;<BR>* (ORACLE_HOME = 
/opt/oracle/product/10g)– указание на папку, в которую произведена установка ПО 
СУБД (на которую указывает также переменная среды $ORACLE_HOME). <BR>Примечание. 
Если на хосте БД 2 сетевые карты, по которым возможны поступления 
пользовательских запросов к БД, то в файле листенера следует указать 2 строки 
адреса&nbsp; с протоколом TCP и указанием IP хоста – т.е. для каждой сетевой 
карты по своей строке.<BR>После редактирования файла listener.ora нужно 
запустить листенер с помощью команд lsnrctl:<BR>lsnrctl stop<BR>lsnrctl 
start<BR>Кроме того, работающий листенер может буть перезапущен 
командой:<BR>lsnrctl reload<BR>В любой момент состояние листенера может быть 
проверено командой:<BR>lsnrctl status<BR>В выводе данной команды должны 
присутствовать наименования SID экземпляров БД, созданных на данном сервере. 
Если в выводе не читаются русские буквы, можно перед выполнением запроса статуса 
переопределить параметры сессии для языка с помощью команды:<BR>export 
NLS_LANG=AMERICAN<BR>Настройка файла tnsnames.ora для подключения 
клиентов<BR>Клиентские приложения узнают о доступных для использования БД из 
файла tnsnames.ora. На сервере БД он располагается там же, где и файл 
listener.ora (если его нет, то следует создать). В него следует добавить 
описание (alias) для только что созданной БД в следующем виде: <BR>rsdu 
=<BR>&nbsp; (DESCRIPTION =<BR>&nbsp;&nbsp;&nbsp; (ADDRESS = (PROTOCOL = 
TCP)(HOST = rsdudb)(PORT = 1521))<BR>&nbsp;&nbsp;&nbsp; (CONNECT_DATA 
=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SERVER = 
DEDICATED)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SERVICE_NAME = 
rsdu.rsdu.ema)<BR>&nbsp;&nbsp;&nbsp; )<BR>&nbsp; )<BR>где зависимые от 
конкретной БД параметры:<BR>* (HOST = rsdudb) – имя хоста сервера БД; 
допускается указание IP-адреса&nbsp; хоста БД;<BR>* (PORT = 1521) – номер порта 
листенера так, как он указан в конфигурационном файле листенера на сервере БД 
(всегда используется значение порта по умолчанию – 1521);<BR>* (SERVICE_NAME = 
rsdu.rsdu.ema) – имя службы БД, указанное при создании БД как "Global Database 
Name" (рис. 3); если имя точно не известно, см. приложение 2.<BR>Настройка файла 
sqlnet.ora <BR>Файл sqlnet.ora содержит некоторые дополнительные параметры для 
настройки подключения клиентов к серверу. Файл располагается там же, где и файл 
listener.ora. Если файл отсутствует, то его следует создать.<BR>Типовое 
содержание файла следующее:<BR>SQLNET.AUTHENTICATION_SERVICES = (NTS, 
NONE)<BR>NAMES.DIRECTORY_PATH = (TNSNAMES, EZCONNECT)<BR>В некоторых случаях, 
например, когда наименование домена сети не совпадает с наименованием домена БД, 
может понадобиться добавление в файл параметра <BR>DB_DOMAIN = 
имя_домена<BR>Проверка работы новой БД<BR>Для проверки, успешно ли была создана 
БД, в терминале на сервере&nbsp; СУБД предлагается подключиться к БД под 
пользователем SYS: <BR>sqlplus / as sysdba<BR>Если выдается сообщение 
"Connected." – это означает, что&nbsp; подключение к БД работает. Далее можно 
приступать к выполнению&nbsp; проверочных запросов, приведенных ниже.<BR>Если 
выдается сообщение "Connected to idle instance." – это означает, что БД не 
запущена. В этом случае рекомендуется проверить наличие серверных процессов в ОС 
командой&nbsp; "ps ax | grep ora_". Если серверные процессы БД Oracle 
отсутствуют, можно попробовать стартовать&nbsp; БД (см. приложение 
1).<BR>Проверочные запросы к БД:<BR>* set linesize 120<BR>select sysdate&nbsp; 
as "Current DateTime", dbtimezone, systimestamp from dual; <BR>Current 
DateTime&nbsp;&nbsp;&nbsp;&nbsp; DBTIME SYSTIMESTAMP<BR>-------------------- 
------ -------------------------------------<BR>=13.02.2013 01:51:57 +11:00 
13.02.13 01:51:57.019270 +11:00<BR>В результатах этого запроса важно, чтобы 
часовой пояс БД&nbsp; (dbtimezone) и часовой пояс ОС (в systimestamp) совпадали 
и отвечали текущим требованиям для БД.<BR>* col host_name format a10<BR>select 
host_name, instance_name, startup_time, status, version, archiver, logins from 
gv$instance;<BR>HOST_NAME INSTANCE_NAME&nbsp; 
STARTUP_TIME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; STATUS&nbsp; 
VERSION&nbsp;&nbsp;&nbsp;&nbsp; ARCHIVE LOGINS<BR>--------- ------------- 
-------------------- ------- ----------- ------- ---<BR>rsdudb&nbsp;&nbsp;&nbsp; 
rsdu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =01.02.2013 03:10:57 
OPEN&nbsp;&nbsp;&nbsp; 10.2.0.5.0&nbsp; STARTED ALLOWED<BR>Этот запрос 
показывает текущее состояние БД – версию ПО, время старта, состояние (OPEN 
соответствует открытому состоянию), разрешены ли подключения клиентов (состояние 
ALLOWED означает, что клиенты могут работать с текущей БД).<BR>Для проверки 
функционирования БД, а также проверки, что выполнена корректная настройка 
листенера и файла tnsnames, следует подключиться к БД с помощью утилиты sqlplus 
c указанием алиаса подключения, например, под системным пользователем 
system:<BR>sqlplus&nbsp; <A 
href="mailto:system/passme@rsdu">system/passme@rsdu</A> <BR>Если подключение 
проходит, то это значит, что все файлы настроены корректно.<BR>Настройка 
автостарта БД <BR>Для того чтобы БД и листенер стартовали автоматически вместе с 
загрузкой ОС, следует выполнить следующие шаги от учетной записи root:<BR>1. В 
файле /etc/sysconfig/oracle установите значение «yes» для следующих 
параметров:<BR>START_ORACLE_DB=«yes»<BR>START_ORACLE_DB_LISTENER=«yes» <BR>2. В 
файле /etc/oratab для автоматического запуска БД РСДУ2 необходимо также 
установить параметр Y: <BR>rsdu:/opt/oracle/product/10g:Y<BR>где используются 
параметры<BR>* rsdu – наименование SID экземпляра БД (регистр букв имеет 
значение!);<BR>* /opt/oracle/product/10g – каталог, в который была произведена 
установка программного обеспечения Oracle (переменная среды $ORACLE_HOME);<BR>* 
третий параметр может принимать два значения: Y (выполнять автостарт экземпляра 
БД) и N (не стартовать автоматически экземпляр БД).</P>
<P>Приложение 1. Ручной запуск и останов экземпляра базы данных <BR>Для 
выполнения перечисленных ниже шагов необходимо подключиться к серверу БДТИ под 
учетной записью oracle.<BR>1. Запустите программу sqlplus<BR>sqlplus 
/nolog<BR>2. После появления приглашения SQL&gt; для запуска экземпляра базы 
данных выполните следующие команды:<BR>connect / as sysdba<BR>startup<BR>3. Для 
остановки экземпляра базы данных воспользуйтесь командами, которые необходимо 
ввести в строке приглашения SQL&gt;:<BR>connect / as 
sysdba<BR>shutdown<BR>Примечание. При работе в терминале на сервере СУБД опция 
«/» подключает вас к БД с правами суперпользователя SYS и с привилегиями 
SYSDBA.<BR>Приложение 2. Изменение глобального имени базы данных <BR>При 
редактировании файла описания подключения tnsnames.ora требуется указать такой 
параметр, как имя службы (SERVICE_NAME).<BR>Если имя SERVICE_NAME точно не 
известно, или при попытке подключения к БД выдается ошибка типа «ORA-12514: TNS 
listener does not currently know of service requested in connect descriptor», то 
уточнить данный параметр можно запросом к БД, который необходимо выполнить на 
сервере СУБД с помощью утилиты sqlplus, под учетной записью oracle:<BR>1. 
Выполнить подключение к БД с помощью команды:<BR>sqlplus / as sysdba<BR>2. 
Набрать в строке приглашения SQL&gt; следующий запрос и нажать клавишу 
«Enter»:<BR>select value from v$parameter where name like 
'service_names';<BR>Полученное значение параметра service_names и следует 
указывать в файлах tnsnames.ora для подключения клиентов к БД в 
предложении&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "SERVICE_NAME = ". Если 
приведенный запрос возвращает для&nbsp; параметра несколько значений, в tnsnames 
указывается одно из них.<BR>Для приведения в соответствие с принятыми на 
предприятии наименованиями значение этого параметра может быть изменено. В этом 
случае потребуется внесение изменений в используемые клиентскими подключениями 
файлы tnsnames.ora (если клиенты используют для подключения к БД локальный файл 
tnsnames.ora, то изменения потребуются на всех этих клиентских 
машинах).<BR>Команда на изменение SERVICE_NAME выполняется также с помощью 
утилиты sqlplus:<BR>alter system set service_names='rsdu.pskov.ema.ru' 
scope=both sid='*';<BR>Следует иметь в виду, что обычно параметр SERVICE_NAME 
принимает составное значение – SID.hostname.domain. <BR>Если потребовалось 
изменить SERVICE_NAME для БД, необходимо проверить и привести в соответствие с 
ним значение глобального уникального имени (GLOBAL_NAME) для этой БД.&nbsp; 
<BR>Проверить параметр GLOBAL_NAME можно с помощью запроса в sqlplus:<BR>select 
global_name&nbsp; from&nbsp; global_name;<BR>Изменить параметр GLOBAL_NAME можно 
с помощью команды в sqlplus: <BR>alter database&nbsp; rename global_name to 
"rsdu.pskov.ema.ru";</P>
<P>Установка переменных окружения пользователя oracle <BR>Добавьте в файл 
/home/oracle/.bash_profile следующие строки <BR>export ORACLE_BASE=/app/oracle 
export ORACLE_SID=&lt;имя БД&gt;&lt;номер узла&gt; <BR>export 
ORACLE_HOME=$ORACLE_BASE/product/10.2.0/db export 
ORA_CRS_HOME=/app/crs/product/10.2.0/crs export 
PATH=$ORACLE_HOME/bin:$ORA_CRS_HOME/bin:$PATH <BR>Где: <BR>&lt;имя БД&gt; - имя 
базы данных в конфигурации Oracle RAC; <BR>&lt;номер узла&gt; - порядковый номер 
узла кластера.</P>
<P>Настройка автоматического резервного копирования БД <BR>Введение <BR>Для 
восстановления БД с наименьшими потерями данных в случае фатальной ошибки 
необходимо использование ее наиболее свежей резервной копии. Автоматизация 
процесса резервного копирования возможна с помощью программ: <BR>??RMAN 
(Recovery MANager) – встроенное средство ORACLE для выполнения операций 
резервного копирования БД. Иcпользование RMAN возможно только в случае, если БД 
работает в режиме ARCHIVELOG; <BR>??EXP (утилита для экспорта данных БД) – 
встроенное средство ORACLE для выполнения операций логического резервного 
копирования БД. </P>
<P>Выбор способа организации автоматического резервного копирования зависит от 
режима работы БД (ARCHIVELOG или NOARCHIVELOG) и доступного дискового 
пространства. При работе БД в режиме NOARCHIVELOG может быть настроено только 
логическое резервное копирование. Если доступное дисковое пространство и режим 
работы БД позволяет, могут быть настроены оба способа создания резервных копий. 
Место хранения файлов резервного копирования: <BR>??для односерверной БД - 
локальный диск сервера; <BR>??для кластерной БД - локальный диск 1-ого узла 
кластера для RMAN и локальный диск 2-ого узла кластера для логического 
резервного копирования. </P>
<P>Возможна настойка автоматического переноса полученных резервных копий на 
удаленный узел. При отсутствии настройки автоматического копирования/переноса 
резервных копий БДТИ на удаленный узел для хранения следует рекомендовать 
ответственному лицу предприятия для защиты от стихийных бедствий и прочих 
непредвиденных ситуаций периодически сбрасывать на автономные носители (CD, DVD, 
другое) содержание папок хранения файлов резервного копирования 
(/opt/oracle/backup/rman_dest и /opt/oracle/backup/export_dest, для кластерной 
БДТИ соответственно на 1-м и 2-м узлах). Также необходимо периодически 
осуществлять контроль за расходованием свободного пространства на локальных 
дисках узлов и удалять старые копии и лог-файлы.<BR>Шаг 1. Проверка текущего 
режима работы БД (под oracle) <BR>Поскольку останов БД для выполнения «холодной» 
копии нежелателен (БД недоступна все время выполнения операции), необходимо 
чтобы БД работала в режиме архивирования журналов повтора (режим ARCHIVELOG), 
т.к. только в этом случае доступно «горячее» резервное копирование, т.е. без 
останова БД. Проверить, в каком режиме находится БД, можно следующим запросом (в 
sqlplus, TOAD или др.): SELECT log_mode FROM gv$database; Если результат запроса 
- NOARCHIVELOG, значит, прежде чем приступить к настройке автоматического 
резервного копирования с RMAN необходимо перевести БД в режим ARCHIVELOG (см. 
документ «Инструкция по выполнению перевода кластерной БД в режим 
ARCHIVELOG.doc», для некластерных БД – также «Инструкция по переводу 
односерверной БД в режим ARCHIVELOG.doc»). При работе БД в режиме NOARCHIVELOG 
может быть настроено только логическое резервное копирование. <BR>Шаг 2. 
Создание необходимой структуры каталогов (под oracle) <BR>Стандартно место 
хранения файлов резервного копирования RMAN определяем на локальном диске 
сервера (для некластерной БД – соответственно на локальном диске этого сервера), 
для файлов логического экспорта – локальный диск 2-ого узла. Необходимо 
доступное свободное пространство на локальном диске каждого узла – не менее 
40-50 Gb (проверить командой df –h). Последовательно выполняем команды создания 
каталогов (подключение с правами пользователя oracle): <BR>mkdir 
/opt/oracle/backup <BR>mkdir /opt/oracle/backup/rman_dest <BR>mkdir 
/opt/oracle/backup/export_dest <BR>mkdir /opt/oracle/backup/export_dest/old 
<BR>mkdir /opt/oracle/backup/script <BR>mkdir /opt/oracle/backup/script/old 
<BR>mkdir /tmp/smbpoint <BR>Для кластерной БДТИ повторяем эти же действия на 
другом узле кластера (для симметрии, могут понадобиться при недоступности 1-ого 
узла кластера и восстановлении БД из резервной копии со 2-ого узла).<BR>Шаг 3. 
Создание сценария оболочки для запуска RMAN (под oracle) <BR>На первом узле 
кластера в папке /opt/oracle/backup/script/ создаем файл rman.sh (копированием 
или иным доступным способом, содержание файла см. Приложение 1). То тексту 
файла-сценария rman.sh внести изменения – при необходимости – в начале файла при 
объявлении переменных среды ORACLE_HOME, ORACLE_SID и LOGIN_STRING указываем 
актуальные значения для данной БД. Назначаем права на файл: chmod 755 rman.sh. 
<BR>Шаг 4. Настройка параметров RMAN (под oracle) <BR>На первом узле кластера 
выполняем запуск программы RMAN командой: $ORACLE_HOME/bin/rman TARGET / 
Примечание: если в терминале некорректно отображаются русские буквы, можно 
предварительно включить для данной сессии английский язык командой export 
NLS_LANG=AMERICAN. После появления приглашения RMAN&gt; выполнить команду: show 
all; Появится следующее сообщение, содержащее перечень параметров по умолчанию 
для RMAN: RMAN configuration parameters are: <BR>CONFIGURE RETENTION POLICY TO 
REDUNDANCY 2; <BR>CONFIGURE BACKUP OPTIMIZATION ON; <BR>CONFIGURE DEFAULT DEVICE 
TYPE TO DISK; <BR>CONFIGURE CONTROLFILE AUTOBACKUP ON; <BR>CONFIGURE CONTROLFILE 
AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/opt/oracle/backup/rman_dest/cf%F'; 
<BR>CONFIGURE DEVICE TYPE DISK BACKUP TYPE TO COMPRESSED BACKUPSET PARALLELISM 
1; <BR>CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; <BR>CONFIGURE 
ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; CONFIGURE CHANNEL DEVICE 
TYPE DISK FORMAT '/opt/oracle/backup/rman_dest/df%T_%s_%p'; <BR>CONFIGURE 
MAXSETSIZE TO UNLIMITED; <BR>CONFIGURE ENCRYPTION FOR DATABASE OFF; 
<BR>CONFIGURE ENCRYPTION ALGORITHM 'AES128'; <BR>CONFIGURE ARCHIVELOG DELETION 
POLICY TO NONE; <BR>CONFIGURE SNAPSHOT CONTROLFILE NAME TO 
'/opt/oracle/backup/rman_dest/snapcf_rsdu.f'; </P>
<P>Примечание: для строки задания политики хранения резервных копий (RETENTION 
POLICY) в случае, если место на локальном диске узла ограничено (не более 50 
Гб), следует указать избыточноть 1, т.е. 1 полная копия): CONFIGURE RETENTION 
POLICY TO REDUNDANCY 1; По окончании редактирования параметров RMAN по умолчанию 
проверить результат повторным вводом команды: show all; Выход из программы rman 
по команде: exit; </P>
<P>Шаг 5. Тестирование работы сценария rman.sh (под oracle) <BR>Выполнить запуск 
сценария оболочки rman.sh из папки: /opt/oracle/backup/script: cd 
/opt/oracle/backup/script ./rman.sh В зависимости от дня недели и даты в этой же 
папке должны появиться файлы с названиями вида: inc0_0307.rcv inc0_0307.log и 
начаться исполнение резервного копирования БД с выводом сообщения вида: Today is 
Friday. Incremental backup level arc RMAN&gt; 2&gt; 3&gt; 4&gt; 5&gt; 6&gt; 
7&gt; 8&gt; 9&gt; 10&gt; 11&gt; 12&gt; 13&gt; 14&gt; 15&gt; 16&gt; 17&gt; 
Предупреждение: следует учесть, что если уровень не level arc, (это зависит от 
текущего дня недели и конкретных параметров запуска, указанных в скрипте: по 
будням это обычно должен быть level arc, в воскресенье – level 0), - то данная 
задача требует значительного времени – 3-5 часов и более в зависимости от 
размеров БД и производительности сервера. Также ее выполнение приводит к 
заметному притормаживанию обычных задач БДТИ. Поэтому на этапе тестирования 
работы сценария после получения вышеуказанного сообщения можно остановить ее 
нажатием CTRL-C. <BR>После первого полного (без прерывания по CTRL-C) выполнения 
команды (например, ночного по расписанию в crontab) следует проконтролировать 
результаты работы резервного копирования просмотром log-файла. В нем не должно 
быть ошибок ORA-xxxxx и RMAN-xxxxx. Если есть – см. приложение 2. Инструкция по 
настройке автоматического резервного копирования БД 6 </P>
<P>Шаг 6. Вставка запуска сценария rman.sh в ежедневное расписание (под root) 
<BR>Для кластерной БДТИ выполняем на 1-ом узле кластера. Для вставки запуска 
сценария резервного копирования в расписание ежедневно выполняемых задач 
выполняем с правами пользователя root следующую команду: crontab -u oracle –e 
Откроется окно редактора vi. В нем ввести следующую строку: 10 03 * * * 
/opt/oracle/backup/script/rman.sh &gt;/opt/oracle/backup/script/run_rman.log 
2&gt;&amp;1 (это все одна строка) где: 10 03 * * * время запуска сценария 03:10, 
ежедневно; /opt/oracle/backup/script/rman.sh наименование исполняемого файла 
bash-сценария; &gt;/opt/oracle/backup/script/run_rman.log 2&gt;&amp;1 
направление лога и ошибок работы в файл run_rman.log; с его помощью можно будет 
проверить, как отработал cron. Примечание: Как работать в vi: После команды 
crontab -u oracle -e появляется окно редактора vi, в нем: <BR>1) нажать «ESC» – 
вошли в режим команд, <BR>2) нажать «i» – вошли в режим вставки (внизу появилась 
строка INSERT), <BR>3) набрать нужный текст, <BR>4) нажать опять «ESC», <BR>5) 
затем нажать «Shift+ZZ» (Shift держим и Z 2 раза) – сохранили (выйти без 
сохранения – набрать «:q» и затем нажать «Enter» ) </P>
<P>После выхода из файла с сохранением результатов появится строка: crontab: 
installing new crontab В указанное время данный сценарий оболочки будет 
исполнен, проконтролировать результат можно с помощью файлов 
/opt/oracle/backup/script/run_rman.log и соответствующего inc*_*.log в той же 
папке. На этом первичную настройку автоматического резервного копирования с RMAN 
считаем завершенной. Типовые параметры и требования к доступному свободному 
пространству должны обеспечить нормальное функционирование задачи (см. также 
пункты «Организация автоматического переноса резервных копий БД на удаленный 
узел» и «Организация контроля доступного свободного пространства на 
сервере»).<BR>Настройка логического резервного копирования <BR>Шаг 1. Создание 
необходимой структуры каталогов (под oracle) <BR>Стандартно место хранения 
файлов логического экспорта определяем на локальном диске сервера – для 
односерверной БД и локальный диск 2-ого узла кластера – для кластерной БД. 
Необходимо доступное свободное пространство на локальном диске каждого узла – не 
менее 40-50 Gb (проверить командой df –h). Последовательно выполняем команды 
создания каталогов (подключение с правами пользователя oracle): <BR>mkdir 
/opt/oracle/backup <BR>mkdir /opt/oracle/backup/rman_dest <BR>mkdir 
/opt/oracle/backup/export_dest <BR>mkdir /opt/oracle/backup/export_dest/old 
<BR>mkdir /opt/oracle/backup/script <BR>mkdir /opt/oracle/backup/script/old 
<BR>mkdir /tmp/smbpoint <BR>Для кластерной БДТИ повторяем эти же действия на 
другом узле кластера (для симметрии, могут понадобиться при недоступности 2-ого 
узла кластера для настройки экспорта на 1-м). <BR>Шаг 2. Создание сценария 
оболочки для запуска утилиты экспорта (под oracle) <BR>На втором узле кластера в 
папке /opt/oracle/backup/script/ создаем файл exp.sh (копированием или иным 
доступным способом, содержание файла см. Приложение 2, в репозитарии 
backup_script.rar). При необходимости по тексту файла-сценария exp.sh внести 
изменения: в начале файла при объявлении переменных среды ORACLE_SID и 
LOGIN_STRING указываем актуальные значения для данной БД. Назначаем права на 
файл: chmod 755 exp.sh. <BR>Шаг 3. Тестирование работы сценария exp.sh (под 
oracle) <BR>Выполняется на 2-м сервере. Выполнить запуск сценария оболочки 
exp.sh из папки /opt/oracle/backup/script. Начнется экспорт БД (в зависимости от 
дня недели и даты). По окончании работы в папке /opt/oracle/backup/export_dest 
появятся файлы с названиями вида: fullexp_0307.dmp.gz fullexp_0307.log.gz 
Проконтролировать результаты работы резервного копирования просмотром log-файла. 
В конце файла должно присутствовать сообщение «Экспорт завершен успешно без 
предупреждений». Не переходить к следующему шагу, если результат содержит 
ошибки. Инструкция по настройке автоматического резервного копирования БД 8 
<BR>Шаг 4. Вставка запуска сценария exp.sh в ежедневное расписание (под root) 
<BR>Выполняем на 2-м узле кластера. Для вставки запуска сценария резервного 
копирования в расписание ежедневно выполняемых задач выполнить с правами 
пользователя root следующую команду: crontab -u oracle –e Далее в окне редактора 
vi ввести следующую строку (одной строкой): 10 02 * 2 * 
/opt/oracle/backup/script/exp.sh &gt;/opt/oracle/backup/script/run_export.log 
2&gt;&amp;1 где: 10 02 * 2 * время запуска сценария 02:10, по вторникам; 
/opt/oracle/backup/script/exp.sh наименование исполняемого файла bash-сценария; 
&gt;/opt/oracle/backup/script/run_export.log 2&gt;&amp;1 направление лога и 
ошибок работы в файл run_export.log; с его помощью можно будет проверить, как 
отработал cron. Закрыть окно редактора с сохранением (см. шаг 6 в разделе 
настройки резервного копирования с помощью RMAN). Появится сообщение: crontab: 
installing new crontab На этом настройка логического резервного копирования 
завершена. (См. также пункты «Организация автоматического переноса резервных 
копий БД на удаленный узел» и «Организация контроля доступного свободного 
пространства на сервере»). <BR>Организация автоматического переноса резервных 
копий БД на удаленный узел <BR>Для предотвращения потери файлов архивных копий в 
случае сбоя локального диска узла кластера, а также для предупреждения 
возможного останова БДТИ в случае, если все свободное пространство на локальном 
диске сервера будет исчерпано под хранение архивов, настоятельно рекомендуется 
организовать автоматический перенос файлов на удаленный узел, выделенный для 
хранения резервных копий БДТИ, если таковой имеется. При отсутствии другого 
файл- сервера в сети, копирование настраивается на сервер ресурсов РСДУ (rserv), 
при условии наличия на нем достаточного свободного пространства (от 100 Гб). Для 
настройки копирования в любом случае необходимо иметь следующую информацию: 
<BR>1. IP-адрес машины для хранения бэкапов БД. <BR>2. Наименование открытой для 
доступа папки на этой машине. <BR>3. Имя/пароль пользователя, имеющего права 
доступа к этой папке (чтение/запись). <BR>4. Имя домена или рабочей группы, 
которой принадлежит этот пользователь. <BR>Инструкция по настройке 
автоматического резервного копирования БД 9 </P>
<P>Далее для настройки копирования на удаленный хост необходимо выполнить 
следующие шаги: <BR>1. На удаленом хосте, на который будут копироваться 
созданные файлы резервных копий (в общем случае сервер приложений RSERV, OC Win) 
создать пользователя rsduadmin (пароль стандартный), и включить его в группу 
администраторов. </P>
<P>Далее создать папку rsdu_backup, опубликовать ее для общего доступа и дать 
права пользователю rsduadmin на полный доступ к этой папке (окно свойств папки, 
вкладка «Доступ» и кнопка «Разрешения» и вкладка «Безопасность»). В папке 
rsdu_backup создать подкаталоги: rman_dest rman_dest_1weekago rman_dest_2weekago 
audit <BR>2. На узле кластера БДТИ под root: </P>
<P>Добавить в файл /etc/sudoers строку: oracle ALL=(ALL) NOPASSWD: ALL <BR>3. 
Под oracle - coздать локальную папку для точки монтирования папки хранения 
удаленного хоста: </P>
<P>mkdir /tmp/smbpoint chown oracle:oinstall /tmp/smbpoint chmod 664 
/tmp/smbpoint <BR>4. Под oracle выполнить пробное монтирование папки удаленного 
хоста: <BR>sudo mount -t cifs -o username=rsduadmin%upwd 
//192.168.50.250/rsdu_backup /tmp/smbpoint <BR>где rsduadmin%upwd – имя и пароль 
пользователя на удаленном хосте; 192.168.50.250 - IP удаленного хоста. Можно 
использовать имя хоста, если оно прописано в /etc/hosts. Для проверки прав на 
запись, выполнить команды: echo test &gt; /tmp/smbpoint/test cat 
/tmp/smbpoint/test Отмонтировать папку удаленнго хоста: sudo umount 
/tmp/smbpoint <BR>5. В файле сценария резервного копирования (rman.sh, exp.sh) 
внести изменения в секцию описания параметров подключения к удаленному хосту 
следующим образом: <BR>SMB='YES' SMB_ADDRESS='//192.168.50.250/rsdu_backup' 
SMB_LOGIN='rsduadmin' SMB_PASSWORD='upswd' SMB_MPOINT='/tmp/smbpoint' Здесь: 
SMB='YES' – флаг, что следует перенести файлы на удаленный хост (значение 'NO', 
соответственно, - нет переноса); </P>
<P><BR>Организация контроля доступного свободного пространства на сервере <BR>В 
заключение данной инструкции следует сказать, что в соответствие с добавляемыми 
функциями (создание и хранение резервных копий БД) требуются дополнительные 
ресурсы сервера БД (место на диске, увеличение загрузки во время выполнения 
резервного копирования), использование которых может потребовать дополнительной 
настройки. Типовые параметры и требования к доступному свободному пространству 
должны обеспечить нормальное функционирование задач резервного копирования. 
Однако индивидуальные или временные особенности работы БД (большой объем 
обрабатываемых параметров, временно большой объем изменений) могут привести к 
быстрому заполнению всего доступного свободного пространства на локальном диске 
узла, и как следствие, отказу резервного копирования или функционирования узла в 
целом. Ответственному лицу предприятия следует рекомендовать контролировать 
размеры пространства, занимаемого резервными копиями и логами (периодический 
контроль и, при необходимости, удаление старых логов и файлов резервного 
копирования 1-2 раза в месяц). На первом узле кластера следует периодически 
удалять log- и rcv-файлы из папки /opt/oracle/backup/script/old и, если не 
настроено копирование на удаленный хост по samba, сбрасывать на автономные 
носители (без удаления с диска) содержимое папки /opt/oracle/backup/rman_dest. 
На 2-м узле кластера, соответственно, периодически удалять лог-файлы в папке 
/opt/oracle/backup/export_dest/old и, если не настроен перенос на удаленный хост 
по samba, сбрасывать на автономные носители содержимое папки 
/opt/oracle/backup/export_dest . Если место, которое может быть выделено на 
локальном диске сервера под создание резервных копий БД, сильно ограничено, 
может быть проведена дополнительная настройка сценариев для уменьшения глубины 
хранения копий, и соответственно, уменьшения требований к пространству (по 
умолчанию – для RMAN 2 недели (или 2 полные копии БД), для логического экспорта 
– 1 месяц).<BR>Приложение 6. Описание формирования и движения файлов экспорта 
БДТИ между сервером БД и удаленным узлом <BR>Для автоматического выполнения 
логического экспорта БДТИ РСДУ используется подготовленный сценарий оболочки 
exp.sh, стандартно размещаемый в папке /opt/oracle/backup/script на сервере БД 
(для кластерной БДТИ – на одном из узлов кластера БД). Данный сценарий 
предусматривает выполнение следующих шагов: <BR>1. Определение переменных среды 
окружения (часть нужна для корректной работы утилиты экспорта, другая часть 
определяет наименование папок для хранения файлов экспорта). <BR>2. Формирование 
уникального имени файла экспорта и log-файла на основе текущей даты (стандартный 
формат имени файлов fullexp_DDMM.dmp, fullexp_DDMM.log, где DDMM = число и месяц 
выполнения экспорта). <BR>3. Перенос предыдущего файла экспорта (если есть) из 
текущей папки расположения файлов экспорта в подпапку old. <BR>4. Если день 
недели соответствует заданному дню выполнению экспорта (стандартно - пятница), 
то выполняется запуск утилиты экспорта БД exp с опцией FULL=Y (полный экспорт 
БД). <BR>5. По завершении работы утилиты экспорта выполняется сжатие полученных 
файла экспорта и лог-файла программой gzip. <BR>6. Если определена переменная 
SMB, указывающая необходимость переноса полученных файлов на удаленный узел, то 
выполняется монтирование точки доступа с заданными параметрами подключения, 
перенос файлов и последующее размонтирование точки доступа. Примечание: для 
успешного выполнения команды монтирования необходимо включить пользователя 
oracle в круг пользователей, которым разрешено выполнять команду sudo без ввода 
пароля суперпользователя. Для этого с правами суперпользователя (root) 
отредактируйте файл /etc/sudoers: добавьте строку: </P>
<P>oracle ALL=(ALL) NOPASSWD: ALL</P>
<P>Если при запуске экземпляра БД он не монтируется и ORACLE выдает сообщение о 
том, что имеется сбой чтения или несогласованность управляющего и/или иных 
файлов БД (см. файлы alert.log экземпляров) БДТИ может быть быстро восстановлена 
на той же (или такой же) конфигурации оборудования при наличии резервной копии 
RMAN, либо импортом на другом (временном) сервере БД из последнего файла дампа 
БД. Если сбой БД произошел из-за отказа оборудования, то восстановление с RMAN 
на той же конфигурации оборудования возможно после устранения неполадок с 
оборудованием, - например, после замены диска при отказе диска, или же следует 
восстановить БД на&nbsp; другом «временном» сервере до устранения неполадок с 
основным сервером. При некоторых случаях сбоев, например, при потере не 
содержащего данных файла БД, такого как&nbsp; журнал повтора транзакций, или 
одного из нескольких (но не всех) управляющих файлов, восстановление 
работоспособности БД возможно без использования резервных копий.<BR>Перед 
началом процедуры восстановления следует проверить установленные переменные 
среды ORACLE_SID и ORACLE_HOME и при необходимости установить нужные значения: 
<BR>set | grep ORACLE<BR>export ORACLE_SID=rsdu1<BR>Для кластерной БД с файлами 
под управлением ASM должны работать (быть ONLINE) кластерные сервисы и ASM хотя 
бы на одном узле, том, с которого будет производится процедура 
восстановления.</P>
<P>Здесь: <BR>&nbsp; файлы с префиксом cfs– автобэкап управляющего файла БД; 
может быть использован для восстановления управляющего файла/файлов и серверного 
файла параметров. Формат названия файла&nbsp;&nbsp; отражает идентификатор 
целевой БД (DBID) и дату копии: cfc-&lt;DBID&gt;-&lt;date&gt;-00;<BR>&nbsp; файл 
snapcf_rsdu.f – файл-снимок управляющего файла БД может быть использован для 
восстановления управляющего файла/файлов;<BR>&nbsp; файлы с префиксом inc0_ – 
бэкапы БД уровня 0 (полные) – базовые резервные копии&nbsp; для восстановления 
БД. Формат имени файла «inc0_MMDD_», таким образом 4 цифры «0520» отражают дату 
выполнения операции резервного копирования;<BR>&nbsp; файлы с префиксом inc1_, 
inc2_&nbsp; – инкрементальные бэкапы БД уровней 1,2&nbsp; – используются накатом 
на уровень 0 для восстановления к ближайшему к точке сбоя состоянию;<BR>&nbsp; 
файлы с префиксом incarc&nbsp; – бэкапы архивных журналов повтора – используются 
накатом после уровней 0,1,2 для восстановления к ближайшему к точке сбоя 
состоянию.&nbsp; </P>
<P>Полезные при восстановлении команды RMAN<BR>В процессе работ по 
восстановлению может понадобиться дополнительная информация о названиях файлов 
БД, имеющихся в резервных копиях, SCN и датах создания этих копий. Ниже 
приведены команды, которые позволят получить информацию в RMAN при условии, что 
БД находится режиме mount или open.<BR>1. Получение имен файлов, которые могут 
быть восстановлены:<BR>list backup recoverable;<BR>2. Список файлов копий 
RMАN&nbsp; для файлов БД<BR>list backup summary; <BR>list backup recoverable; 
<BR>3. Проверка восстановления физических файлов данных БД. <BR>restore database 
preview;<BR>4. Проверка восстановления конкретного файлов данных. <BR>restore 
datafile 1 preview;<BR>5. Варианты команды&nbsp; recover database<BR>Если 
необходимо восстановить БД на какой-то определенный момент времени, возможны 
также варианты команды<BR>recover database until time 'DD.MM.YYYY 
hh:mi:ss';<BR>recover database until scn 123456;</P>
<P>Вариант 3. Восстановление файла параметров БД<BR>Ситуация: известно, что 
отсутствует серверный файл параметров и/или&nbsp; при попытке старта БД выдается 
сообщение <BR>ORA-01078: failure in processing system parameters<BR>Серверный 
файл параметров spfile&lt;SID&gt;.ora некластерной БД без ASM по умолчанию 
находится в папке $ORACLE_HOME/dbs. <BR>Серверный файл кластерной БД по 
умолчанию находится на дисках общей дисковой стойки под управлением ASM&nbsp; и 
имеет название '+DATA/&lt;UNIQUE_NAME&gt;/spfile&lt;UNIQUE_NAME&gt;.ora', где 
+DATA – наименование дисковой группы в ASM, &lt;UNIQUE_NAME&gt; - уникальное имя 
кластерной БД («rsdu»; не путать с SID экземпляров, которые имеют еще 
добавленную цифру – номер узла кластера). При этом в папке $ORACLE_HOME/dbs узла 
кластера находится текстовый файл параметров PFILE с названием 
init&lt;SID&gt;.ora, который указывает, где именно находится серверный файл 
параметров. Пример содержания файла 
$ORACLE_HOME/dbs/initrsdu1.ora:<BR>SPFILE='+DATA/rsdu/spfilersdu.ora'<BR>Если 
есть отдельная резевная копия SPFILE, следует выложить ее в папку 
$ORACLE_HOME/dbs. Для кластерной БД после этого изменить ссылку на SPFILE в 
файле PFILE. <BR>Внимание! Не путать текстовый файл параметров 
(PFILE=initrsdu1.ora) с серверным файлом параметров (SPFILE=spfilersdu.ora). 
Серверный файл параметров НЕЛЬЗЯ править в редакторе! Хотя можно скопировать из 
него параметры и вставить в PFILE.<BR>Если отдельной копии SPFILE нет, можно 
восстановить PFILE в RMAN из автобэкапа управляющего файла, а затем, когда БД 
будет в рабочем состоянии, пересоздать из него SPFILE.<BR>Действия в rman по 
восстановлению SPFILE:<BR>1. Стартовать экземпляр БД в режиме force nomount 
<BR>startup force nomount;</P>
<P>2. Если экземпляр стартовал успешно, без сообщений об ошибках, значит spfile 
успешно найден, перейти к п.7.<BR>3. Если экземпляр стартовал, но при этом 
присутствует сообщение <BR>сбой при запуске: ORA-01078: failure in processing 
system parameters<BR>...<BR>запуск экземпляра Oracle без файла параметров для 
извлечения spfile<BR>то восстанавливаем файл параметров из резервной копии 
(автобэкапа) управляющего файла. <BR>4. Устанавливаем DBID (взять свой из 
названия имеющегося в резервных копиях файла автобэкапа, см.выше) и формат 
следующими командами: <BR>set DBID 3955513268;<BR>set controlfile autobackup 
format for device type disk to '/opt/oracle/backup/rman_dest/cf%F';<BR>5. 
Выполняем команду восстановления ini-параметров в PFILE:<BR>restore spfile to 
pfile '/opt/oracle/backup/rman_dest/init.temp' from autobackup;<BR>Ожидаемый 
ответ:<BR>Запуск restore в =20.05.2010 10:06:26<BR>занятый канал: 
ORA_DISK_1<BR>канал ORA_DISK_1: sid=33 devtype=DISK</P>
<P>канал ORA_DISK_1: поиск автоматической резервной копии для даты: 
20100519<BR>канал ORA_DISK_1: поиск автоматической резервной копии для даты: 
20100518<BR>канал ORA_DISK_1: найдена автоматическая резервная копия: 
/opt/oracle/backup/rman_dest/cfc-3955513268-20100520-00<BR>канал ORA_DISK_1: 
восстановление SPFILE из автоматической резервной копии выполнено<BR>Завершение 
restore в =20.05.2010 10:06:29<BR>6. После создания PFILE вернуться к 
соответствующему варианту восстановления БДТИ и выполнять старт БД уже с 
указанием файла PFILE.</P>
<P><BR>Вариант 4. Восстановление серверного файла параметров SPFILE<BR>Ситуация: 
БД находится в рабочем состоянии, но известно, что отсутствует серверный файл 
параметров и известно, что БД стартована с указанием файла параметров PFILE либо 
(для кластерной БД) из резервного SPFILE на локальном диске узла 
кластера.<BR>Необходимо восстановить серверный файл параметров SPFILE на его 
обычном месте для автостарта БД при перезапуске сервера. <BR>Действия по 
восстановлению SPFILE:<BR>1. В окне терминала на сервере БД подключится к БД 
в&nbsp; sqlplus<BR>(при необходимости сначала выполнить export 
ORACLE_SID=&lt;SID&gt;) .<BR>sqlplus / as sysdba<BR>2. Для восстановления из 
PFILE (если БД стартована с PFILE):<BR>Для некластерной БД:<BR>create 
spfile='/opt/oracle/product/10g/dbs/spfilersdu1.ora' from 
pfile='/opt/oracle/backup/rman_dest/init.temp';<BR>Для кластерной БД:<BR>create 
spfile='+DATA/rsdu/spfilersdu.ora' from 
pfile='/opt/oracle/backup/rman_dest/init.temp';<BR>где <BR>pfile=&nbsp; – 
указать конкретный файл, с которым БД была стартована;<BR>spfile= – указать имя 
файла; для некластерной БД должен быть создан в папке $ORACLE_HOME/dbs. Для 
кластерной БД указать путь и название файла на общедоступном для узлов 
пространстве на дисковой группе под управлением ASM. <BR>3. Для восстановления 
из резервного SPFILE (если кластерная БД стартована с SPFILE, восстановленном на 
локальном диске узла кластера):<BR>Создать SPFILE на ASM можно сначала создав 
PFILE, а затем из него перенести его на ASM:<BR>create pfile='/tmp/initrsdu.ora' 
from spfile;<BR>create spfile='+DATA/rsdu/spfilersdu.ora' from 
pfile='/tmp/initrsdu.ora ';<BR>Кроме того, для кластерной БД после создания 
SPFILE необходимо проверить/скорректировать файл init&lt;SID&gt;.ora в папке 
$ORACLE_HOME/dbs, чтобы он указывал на файл SPFILE на ASM. <BR>Пример содержания 
файла initrsdu1.ora:<BR>SPFILE='+DATA/rsdu/spfilersdu.ora'<BR>4. В заключение 
необходимо выполнить перезапуск экземпляра в обычном режиме старта:<BR>shutdown 
immediate<BR>startup</P>
<P>Если БД не запускается, значит SPFILE создан неправильно, выполнить останов 
БД, вновь стартовать с предыдущим PFILE или SPFILE и снова – внимательнее, - 
повторить действия по созданию SPFILE.</P>
<P>Вариант 5. Восстановление управляющего файла БД<BR>Ситуация: Известно, что 
отсутствует управляющий файл БД и/или если после ввода команды mount появляется 
сообщение <BR>ORA-00205: ошибка при идентификации управляющего файла, за доп. 
информацией обратитесь к журналу предупреждений<BR>Это говорит о том, что 
поименованный&nbsp; в параметре «control_files» в файле инициализационных 
параметров БД (SPFILE или PFILE) управляющий файл, или может быть несколько 
файлов или один из нескольких, не найден в указанном месте или поврежден. Если 
место указано правильно и файл действительно отсутствует, требуется 
восстановление управляющего файла/файлов. <BR>Внимание: здесь и далее, когда БД 
восстанавливается на прежнем месте, выполнение команды restore приводит к 
затиранию одноименных файлов БД, если они присутсвуют на этом месте. Таким 
образом возврат к тому состоянию БД, которое было&nbsp; до выполнения restore 
будет невозможен. <BR>Действия по восстановлению в rman управляющего файла 
(файлов):<BR>1. Устанавливаем (если еще не установлены в текущей сессии rman) 
DBID (взять свой из названия имеющегося в резервных копиях файла автобэкапа, 
см.выше) и формат следующими командами: <BR>set DBID 3955513268;<BR>set 
controlfile autobackup format for device type disk to 
'/opt/oracle/backup/rman_dest/cf%F';<BR>Далее для каждого управляющего файла 
поимённо в соответствии с местоположением и названием, указанным в параметре 
«control_files»&nbsp; выполняем&nbsp; команду: <BR>restore controlfile to 
'+DATA/rsdu/controlfile/current.369.719458037' from 
autobackup;<BR>или<BR>restore controlfile to 
'+DATA/rsdu/controlfile/current.374.719458037' from 
'cfc-3955513268-20100520-00';<BR>Второй вариант команды следует использовать, 
если необходимо восстановить файлы БД от конкретной даты, потому как по 1-ому 
варианту при наличии нескольких копий управляющего файла rman будет искать самую 
свежую.<BR>Далее выполняем команду монтирования БД или возвращаемся к следующему 
пункту по варианту восстановления БД 1 или 2.<BR>Примечание: при восстановлении 
управляющего файла для кластерной БД (под ASM), когда ASM создает Oracle Managed 
File (OMF), и, соответственно именует файлы в соответствии со своими 
собственными правилами, предпочтительнее окажется использование одной команды 
для восстановления всех файлов единовременно<BR>restore controlfile from 
autobackup;<BR>При этом по завершении работы команды будут выведены новые имена 
управляющих файлов. Эти имена следует внести в файл PFILE, изменив старое 
значение параметра «control_files». После этого следует выполнить останов БД, 
вновь стартовать c использованием PFILE и лишь потом переходить к следующему 
пункту программы.</P>
<P>Вариант 1. Восстановление БДТИ на том же или таком же сервере <BR>Ситуация: 
Восстановление БДТИ происходит на том же сервере или сервере,&nbsp; структура 
папок хранения файлов БД которого полностью совпадает со структорой папок 
исходного сервера БДТИ. <BR>Внимание! Все узлы кластера считаем одним и тем же 
сервером! В файловой системе все папки заранее создать как на исходном 
сервере.<BR>Действия в RMAN по восстановлению БДТИ:<BR>1. Стартовать экземпляр 
БД в режиме force nomount <BR>startup force nomount;</P>
<P>Ожидаемый ответ:<BR>выполнено подключение к базе данных назначения (не 
запущена)<BR>Экземпляр Oracle стартовал</P>
<P>Общий размер глобальной системной области&nbsp;&nbsp;&nbsp;&nbsp; 444596224 
байт</P>
<P>Fixed 
Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1267956 байт<BR>Variable 
Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
192939788 байт<BR>Database 
Buffers&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
243269632 байт<BR>Redo 
Buffers&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
7118848 байт </P>
<P>Если экземпляр стартовал, но при этом присутствует сообщение&nbsp; об 
ошибке&nbsp; ORA-01078, то см. описание ошибки и действия для ее устранения в 
главе «Возможные ошибки при восстановлении БДТИ в RMAN» <BR>2. Выполняем команду 
монтирования базы <BR>sql 'alter database mount';<BR>Если команда проходит без 
ошибок, переходим к п.3, иначе – сначала выполняем действия по варианту 5 
«Восстановление управляющего файла БД» (см. ниже), и уже затем переходим к 
следующему пункту в этом варианте.<BR>3. Выполняем восстановление физических 
файлов данных БД:<BR>restore database;<BR>Все файлы данных БД будут 
восстановлены из копий на тех же местах.<BR>Внимание: здесь и далее, когда БД 
восстанавливается на прежнем месте, выполнение команды restore приводит к 
затиранию одноименных файлов БД, если они уже присутствуют на этом месте. Таким 
образом возврат к тому состоянию БД, которое было&nbsp; до выполнения restore 
будет невозможен. <BR>4. Выполняем команду восстановления БД:<BR>recover 
database;<BR>См. также варианты этой команды ниже в главе «Полезные при 
восстановлении команды RMAN».<BR>В ходе процесса recover поверх файлов БД, 
восстановленных из копии уровня 0 накатываются (если есть) инкрементальные 
бэкапы и архивированные журналы повтора транзакций.<BR>В конце процесса возможно 
сообщение об ошибке RMAN-06054. Если ей не сопутствует ошибка ORA-01547, то 
игнорируем ее.<BR>5. Выполняем открытие БД с опцией resetlogs<BR>sql 'alter 
database open resetlogs';<BR>После выполнения этой команды БД доступна для 
подключения пользователей. <BR>6. Закрываем RMAN (exit)<BR>7. Выполнить проверку 
и другие действия в соответствии с главой «Заключительные действия после 
восстановления БДТИ из копий RMAN».</P>
<P>Вариант 2. Восстановление БДТИ на другом сервере <BR>Ситуация: восстановление 
БДТИ происходит на резервном сервере из копий RMAN исходной кластерной БДТИ или 
на сервере, структура папок которого отличается от исходного сервера (например, 
файлы БД располагаются на других дисках) . <BR>Внимание! Все узлы кластера 
считаем одним и тем же сервером! В файловой системе все папки заранее создать 
как на исходном сервере.<BR>В этом варианте до восстановления требуется внести 
исправления в файл параметров: для ини-параметра «control_files» указать новое 
расположение управляющих файлов БД, для других параметров, указывающих на 
дисковые группы ASM или несуществующие диски и папки файловой системы, задать 
новые пути хранения в файловой системе текущего&nbsp; сервера. Также, если 
исходная БДТИ была кластерной, а&nbsp; восстанавливается в некластерную, удалить 
или закомментировать в PFILE параметры cluster_database_instances и 
cluster_database.<BR>Для возможности исправления этих параметров перед началом 
восстановления необходимо создать/откорректировать временный файл ини-параметров 
PFILE по варианту 3 «Восстановление файла параметров БД» и далее использовать 
этот файл при старте БД. <BR>Действия в RMAN по восстановлению БДТИ:<BR>1. 
Стартовать экземпляр с PFILE в режиме force nomount&nbsp; <BR>startup&nbsp; 
nomount pfile= '/opt/oracle/backup/rman_dest/init.temp';</P>
<P>2. Выполняем восстановление управляющих файлов на новом месте из резервной 
копии в соответствии с вариантом 4 «Восстановление управляющего файла».<BR>3. 
Выполняем команду монтирования базы <BR>sql 'alter database mount';<BR>4. 
Выполняем восстановление физических файлов данных БД. <BR>Т.к. восстановление 
проводится на другом сервере, то при восстановлении файлов на диск потребуется 
переименование всех файлов БД из хранимых в ASM (для кластерной) на хранимые 
просто в файловой системе.&nbsp; Внимание:&nbsp; для каждой БД имена файлов 
индивидуальны!&nbsp; Для выяснения имен и номеров файлов см. главу «Полезные при 
восстановлении команды RMAN».<BR>Для каждого файла исходной БД&nbsp; необходимо 
составить и выполнить сценарий восстановления в следующем виде:<BR>RUN 
{<BR>&nbsp; SET NEWNAME FOR datafile 1 TO 
'/tmp/rsdu/system.258.719411555';<BR>&nbsp; RESTORE datafile 1;<BR>&nbsp; SWITCH 
datafile 1;<BR>&nbsp; }<BR>Ожидаемый результат выполнения :<BR>Выполняется 
команда: SET NEWNAME<BR>Запуск restore в =20.05.2010 10:43:12<BR>использование 
канала ORA_DISK_1<BR>канал ORA_DISK_1: запущено восстановление резервного набора 
файлов данных<BR>канал ORA_DISK_1: задается файл данных для восстановления из 
резервного набора<BR>восстановление файла данных 00001 в 
/tmp/rsdu/system.258.719411555<BR>канал ORA_DISK_1: считывание из фрагмента 
резервной копии /opt/oracle/backup/rman_dest/inc0_0520_1_1_1<BR>канал 
ORA_DISK_1: восстановлена часть копий 1<BR>указатель 
части=/opt/oracle/backup/rman_dest/inc0_0520_1_1_1 тэг=INC0_0520<BR>канал 
ORA_DISK_1: восстановление завершено; затраченное время: 00:01:05<BR>Завершение 
restore в =20.05.2010 10:44:17<BR>файл данных 1 переключен на копию<BR>копия 
входного файла данных, recid=41, отметка=719433298, имя 
файла=/tmp/rsdu/system.258.719411555<BR>Примечание: новые имена файлов могут не 
совпадать со старыми.<BR>5. Выполняем переименование файлов БД, не содержащих 
данные.<BR>Этот пункт актуален только при восстановлении БД на резервном сервере 
- не кластере - из копий исходной кластерной БД, иначе – перейти к следующему 
пункту.<BR>Файлы журналов повтора (online redo-log) и файл временного табличного 
пространства не содержат данных БД и потому не включены в резервную копию RMAN, 
а восстанавливаются пустыми файлами в каталог, указанный ини-параметром 
«db_create_file_dest». Для кластерной БД они находятся на дисковой группе под 
управлением ASM. Чтобы на завершающей стадии восстановления не было ошибки&nbsp; 
из-за попытки обращения RMAN к ASM, которого на новой БД не существует, 
необходимо выполнить переименование этих файлов в управляющем файле БД. Для 
этого открыть отдельное окно терминала под oracle и выполнить в sqlplus 
подключение к БД (при необходимости сначала сделайте export 
ORACLE_SID=&lt;SID&gt;):<BR>sqlplus / as sysdba<BR>Выполняем запрос для выборки 
имен журналов повтора:<BR>select&nbsp; member from v$logfile order by group;</P>
<P>MEMBER<BR>-------------------------------------------<BR>+DATA/rsdu/onlinelog/group_1.368.719458041<BR>+DATA/rsdu/onlinelog/group_1.362.719458043<BR>...<BR>Для 
каждого из файлов в полученном списке выполняем команду переименования 
файла:<BR>ALTER DATABASE RENAME FILE 
'+DATA/rsdu/onlinelog/group_1.368.719458041' TO 
'/tmp/rsdu/group_1.368.719458041';<BR>Примечание: новые имена файлов могут не 
совпадать со старыми.<BR>Внимание!&nbsp;&nbsp; В процессе переименования может 
появляться сообщение об ошибке&nbsp; ORA-00600, которое следует игнорировать и 
продолжить переименование для всех файлов (см. ниже главу «Возможные ошибки при 
восстановлении БДТИ в RMAN»).<BR>Повторным запросом к v$logfile 
проконтролировать, что все лог-файлы переименованы.<BR>Далее выполняем 
запрос<BR>select name from 
v$tempfile;<BR>NAME<BR>----------------------------------------<BR>+DATA/rsdu/tempfile/temp.352.719458063 
<BR>Выполняем переименование этого файла (также игнорируем здесь сообщение об 
ошибке ORA-00600 [kgeade_is_0]):<BR>ALTER DATABASE RENAME FILE 
'+DATA/rsdu/tempfile/temp.352.719458063' TO '/tmp/rsdu/temp.352.719458063';<BR>В 
заключение запросом <BR>select name from v$datafile;<BR>проконтролировать, что 
все файлы данных переименованы. Если да, переходим к следующему пункту, если нет 
- выполнить переименование по алгоритму п.4.<BR>6. Выполняем в RMAN команду 
восстановления БД:<BR>recover database;<BR>См. также варианты этой команды ниже 
в главе «Полезные при восстановлении команды RMAN».<BR>В конце процесса recover 
возможно сообщение об ошибке RMAN-06054. Если ей не сопутствует ошибка 
ORA-01547, то игнорируем ее.<BR>7. Выполняем открытие БД с опцией 
resetlogs<BR>sql 'alter database open resetlogs';<BR>После выполнения этой 
команды БД доступна для подключения пользователей. <BR>8. Закрываем RMAN 
(exit)<BR>9. Выполняем проверку и другие действия в соответствии с главой 
«Заключительные действия после восстановления БДТИ из копий RMAN»</P>
<P>Заключительные действия после восстановления БДТИ из копий RMAN<BR>После того 
как после восстановления выполнена команда открытия БД с опцией resetlogs, 
следует проверить результаты и выполнить некоторые стандартные действия<BR>1. 
Проверка результатов процедуры&nbsp; восстановления.<BR>Выполнить подключение к 
БД в sqlplus и проверку работоспособности экземпляра БД:<BR>sqlplus / as 
sysdba</P>
<P>Выполнить запрос<BR>select instance_name, startup_time, status, logins, 
archiver from gv$instance;</P>
<P>Ожидаемый результат:<BR>INSTANCE_NAME&nbsp;&nbsp;&nbsp; 
STARTUP_TIME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
STATUS&nbsp;&nbsp;&nbsp;&nbsp; LOGINS&nbsp;&nbsp;&nbsp;&nbsp; 
ARCHIVE<BR>---------------- ------------------- ------------ ---------- 
-------<BR>rsdu1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
20.05.2010 12:43:42&nbsp;&nbsp;&nbsp;&nbsp; 
OPEN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ALLOWED&nbsp;&nbsp;&nbsp; STARTED</P>
<P>Обратить внимание, что статус БД «OPEN» и подключение пользовательских сессий 
разрешено (LOGINS=ALLOWED). <BR>Если в результатах запроса присутствует 
LOGINS=RESRTICTED или статус STATUS=STARTED или MOUNTED (не OPEN), следует 
проанализировать файл alert.log&nbsp; и далее предпринять шаги соответственно 
ситуации.<BR>2. Восстановление SPFILE.<BR>Если для восстановления БД старт 
выполнялся с PFILE или (для кластерной БД) с помощью резервного SPFILE, 
скопированного на локальный диск узла кластера, выполнить действия по варианту 4 
«Восстановление серверного файла параметров SPFILE».<BR>3. Запуск 2-ого 
экземпляра кластерной БД.<BR>Если восстанавливаемая БД – кластерая, необходимо 
стартовать 2-ой экземляр. Для этого открыть окно терминала ко 2-му узлу под 
oracle и в программе sqlplus выполнить срарт экземпляра (при необходимости 
предварительно установить ORACLE_SID):<BR>export ORACLE_SID=rsdu2<BR>sqlplus / 
as sysdba<BR>startup</P>
<P>4. Выполнить полное резервное копирование БД. <BR>Можно использовать для 
этого стандартный сценарий резервного копирования rman.sh, скорректировав в 
тексте строку задания дня недели, в который выполняется бэкап уровня 
0:<BR>&nbsp; if [ "$curdayWeekDayNum" == "7" ]; then<BR>здесь 7 – воскресенье. 
Установить нужную цифру в зависимости от текущего дня недели (1-7), после чего 
выполнить скрипт. По завершении&nbsp; резервного копирования вернуть старую 
цифру на место.</P>
<P>Восстановление БД ТИ из логической резервной копии (импорт)<BR>Необходимые 
условия<BR>* Существует новая БД комплекса РСДУ2, в которую необходимо залить 
импорт. <BR>* Резервная копия (FULL экспорт) исходной БДТИ.<BR>* Скрипты 
создания табличных пространств, создаваемых для функционирования комплекса РСДУ2 
(опционально).<BR>* Установлена и запущена служба FTP на сервере, на котором 
будет производиться импорт.<BR>* TOAD, либо какой-то другой клиент доступа к 
БД.<BR>Если в качестве новой БДТИ используется существующая БД РСДУ2, то 
необходимо вначале удалить из нее всю лишнюю информацию, т.е. подготовить ее для 
импорта. <BR>Чистка новой БДТИ от старой информации<BR>Предупреждение: 
подразумевается, что вся информация, перечисленная в необходимых условиях, у вас 
есть.<BR>1. Зайти в TOAD под пользователем sys или system.<BR>2. Удалить (если 
есть) все TableSpaces, с шаблоном имени «RSDU_xxxxx_TAB», при этом следует 
выполнять удаление с опцией «include data files».<BR>3. Удалить tablespaces 
RSDU_TABL с опцией «include data files».<BR>4. Удалить все TableSpaces с 
шаблоном имени «RSDU_xxxxx_IND» и «RSDU_IND», с опцией «include data 
files».<BR>Заполнение новой БДТИ новой информацией<BR>1. Зайти в TOAD под 
пользователем sys или system.<BR>2. Если структура хранения файлов (наименование 
дисков, пути к папкам) на сервере, на котором находится новая БД, отличается от 
структуры исходной БД, следует предварительно создать табличные пространства для 
хранения объектов РСДУ. Для этого открыть скрипт создания табличных пространств, 
изменить нужным образом пути создания файлов БД и выполнить создание табличных 
пространств.<BR>Примечание: если скрипта создания табличных пространств нет, 
можно открыть в текстовом редакторе файл резервной копии (дамп) исходной БДТИ, в 
начале файла найти команды создания табличных пространств и скопировать 
их.<BR>3. Проверить, что все файлы табличных пространств с префиксом RSDU 
созданы с флагом авторасширения и UNLIMITED size. <BR>Примечание: Если известно, 
что на исходной БД табличные пространства какого-либо пользователя-владельца 
схемы архивов занимали более 32 Гб (предельный размер файла для ОС Linux) и при 
этом на новой БД пути к папкам хранения файлов отличаются от исходной БД, 
следует создать дополнительные файлы для этих табличных пространств.<BR>4. 
Скопировать по FTP файл экспорта на машину, на которой находится новая 
БДТИ.<BR>5. Зайти через Putty на машину, на которой находится новая БДТИ, под 
пользователем oracle.<BR>6. Проверить, что установлена правильная кодировка, для 
этого выполнить<BR>env | grep NLS_LANG</P>
<P>7. Если значение не равно RUSSIAN_CIS.CL8MSWIN1251, изменить, выполнив 
команду:<BR>NLS_LANG=RUSSIAN_CIS.CL8MSWIN1251; <BR>export NLS_LANG</P>
<P>8. Запустить импорт БД, выполнив команду:<BR>imp <A 
href="mailto:system/passme@db">system/passme@db</A> file=/path_name/file.dmp 
log=/path_name/file.log full=y ignore=y feedback=1000</P>
<P>где db – имя базы из tnsnames.ora<BR>/path_name/file.dmp – имя файла, 
содержащего дамп, с полным путем к нему;<BR>/path_name/file.log – имя лог-файла 
операции.<BR>Примечание: Если появляется ошибка, что такой команды нет, то 
следует написать полный путь до утилиты импорта, т.е. 
$ORACLE_HOME/bin/imp.<BR>9. При импорте могут быть ошибки, но если в конце будет 
сообщение, что он завершился удачно, но с warnings, это означает, что импорт 
прошел успешно.<BR>10. Зайти в TOAD под sys и выполнить скрипт (нажать 
F5):<BR>delete from&nbsp; db_s_users;<BR>INSERT INTO db_s_users (s_id, 
db_id)<BR>SELECT u.id s_id , a.user_id db_id<BR>FROM all_users a, s_users u 
WHERE a.username LIKE upper (u.login)<BR>ORDER BY u.id;<BR>commit;</P>
<P>11. Если в базе присутствуют таблицы в схеме rsduadmin, синонимы, процедуры и 
т.п., это означает, что работы по наполнению БД новыми данными закончены. 
<BR>12. Выполнить перекомпиляцию инвалидных объектов (если таковые есть) в 
схемах RSDUADMIN и всех архивных владельцев (префикс имени RSDU2)</P>
<P>Восстановление БД при потере файла журнала повтора&nbsp; 
транзакций<BR>Поскольку диагностика и восстановление БДТИ в случае потери файла 
журнала повтора (online redo log) не является операцией, требующей больших 
затрат времени и, вместе с тем, позволяет восстановить БД с меньшими потерями, 
чем в случае использования резервной копии RMAN, данное приложение описывает 
процесс восстановления БД в этом конкретном случае.<BR>Диагностика ошибки: БД не 
доступна/не открывается и в алерт-логе присутствуют ошибки ORA-368, 353, 312 или 
354, 353, 334<BR>ORA-00368: checksum error in redo log block<BR>ORA-00353: log 
corruption near block 83323 change 201842714 time 10/29/2008 
09:47:41<BR>ORA-00312: online log 2 thread 1: '/data2/TUGR/redo02.log'</P>
<P>Или <BR>ORA-00354: corrupt redo log block header<BR>ORA-00353: log corruption 
near block 99894 change 1926113366 time 01/27/2009 09:00:14<BR>ORA-00334: 
archived log: '/data2/TUGR/redo01.log'</P>
<P>Резюме: требуется восстановление БД по случаю утери активного online redo 
log.<BR>Инструкция по восстановлению:<BR>Предварительные действия: 
<BR>Подключиться через Putty к серверу БД (для кластерной БД – к 1 узлу) под 
пользователем oracle.<BR>Проверить установленные переменные среды ORACLE_SID и 
ORACLE_HOME. <BR>set | grep ORACLE</P>
<P>При необходимости установить нужные значения: <BR>export ORACLE_SID=rsdu1</P>
<P>Для БД с использованием серверного файла параметров (а по умолчанию это так) 
требуется предварительно создать текстовый файл инициализационных параметров БД 
(pfile) на основе серверного файла параметров (spfile):<BR>sqlplus / as sysdba 
</P>
<P>SQL&gt; create pfile=’/opt/oracle/admin/init.ora’ from spfile;<BR>File 
created.</P>
<P>Далее можно посмотреть статус имеющихся журналов редо-лог - и выяснить (по 
SCN), какой статус у сбойного журнала. Это видно по результатам следующего 
запроса <BR>SQL&gt; select * from v$log;</P>
<P>&nbsp;&nbsp; GROUP#&nbsp;&nbsp;&nbsp; THREAD#&nbsp; 
SEQUENCE#&nbsp;&nbsp;&nbsp; BYTES&nbsp;&nbsp;&nbsp; MEMBERS ARC 
STATUS&nbsp;&nbsp;&nbsp;&nbsp; FIRST_CHANGE# FIRST_TI<BR>--------- ---------- 
---------- ---------- ---------- --- ------------ 
------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
12071&nbsp;&nbsp; 52428800&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 NO&nbsp; 
ACTIVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 201837930 
29.10.08<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
12072&nbsp;&nbsp; 52428800&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 NO&nbsp; 
CURRENT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 201840094 
29.10.08<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
12070&nbsp;&nbsp; 52428800&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 NO&nbsp; 
ACTIVE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 201834595 29.10.08</P>
<P>Выполнить останов БД.<BR>SQL&gt; shutdown immediate<BR>ORA-01109: database 
not open</P>
<P>Database dismounted.<BR>ORACLE instance shut down.</P>
<P>Основные действия по восстановлению: <BR>1) Выполнить в полученном pfile 
установку параметра _ALLOW_RESETLOGS_CORRUPTION=TRUE.<BR>находим в папке admin 
подготовленный ранее файл pfile (init.ora) и добавляем в него строку 
<BR>_ALLOW_RESETLOGS_CORRUPTION=TRUE</P>
<P>2) Выполняем старт БД в режиме Mount (Startup Mount) с использованием 
модифицированного pfile.<BR>SQL&gt; startup mount 
pfile=’/opt/oracle/admin/init.ora’<BR>ORACLE instance started.</P>
<P>3) Выполняем команду восстановление БД (recover database). <BR>В алерт-логе 
смотрим SCN&nbsp; до которого можно восстановить базу: <BR>&nbsp; ORA-00353: log 
corruption near block 99894 change 1926113366 time 01/27/2009 09:00:14</P>
<P>Отнимем от него 1 и делаем восстановление на полученный SCN:<BR>SQL&gt; 
recover database until change 1926113365;<BR>ORA-01547: warning: RECOVER 
succeeded but OPEN RESETLOGS would get error below<BR>ORA-01194: file 1 needs 
more recovery to be consistent<BR>ORA-01110: data file 1: 
'/data2/RSDU/system01.dbf'</P>
<P>4) Выполняем команду открытия БД с опцией RESETLOGS (Alter database open 
resetlogs).<BR>SQL&gt; Alter database open resetlogs;<BR>Database altered.<BR>5) 
Создаем новую группу журналов повтора (create new log group).<BR>Смотрим, какие 
есть (MEMBER)&nbsp; и их размер (BYTES): <BR>SQL&gt; select * from 
gv$logfile;</P>
<P>&nbsp;&nbsp; INST_ID&nbsp;&nbsp;&nbsp;&nbsp; GROUP# STATUS&nbsp; 
TYPE&nbsp;&nbsp;&nbsp; 
MEMBER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
IS_<BR>---------- ---------- ------- ------- --------------------------- 
-------<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ONLINE 
/data2/TUGR/redo01.log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
NO<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ONLINE 
/data2/TUGR/redo03.log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
NO<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ONLINE 
/data2/TUGR/redo04.log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NO</P>
<P>SQL&gt;&nbsp; select * from v$log;</P>
<P>&nbsp; GROUP#&nbsp;&nbsp;&nbsp; THREAD#&nbsp; SEQUENCE#&nbsp;&nbsp;&nbsp; 
BYTES&nbsp;&nbsp;&nbsp; MEMBERS ARC STATUS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
FIRST_CHANGE# FIRST_TI<BR>--------- ---------- ---------- ---------- ---------- 
--- ------------- -------- ---<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 
52428800&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 YES 
UNUSED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; 
52428800&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 NO&nbsp; 
CURRENT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1926113366 
27.01.09<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 
52428800&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 YES 
UNUSED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0</P>
<P>И создаем новую: <BR>SQL&gt; ALTER DATABASE ADD LOGFILE group 5 
'/data2/TUGR/redo05.log' size 50M;<BR>Database altered.</P>
<P>Если при попытке создания вдруг имеем ошибку ORA-19502 и ORA-27072 – значит 
нет места на диске, на котором создаем. Освободить, например, уменьшением других 
файлов БД. <BR>6) Удаляем сбойную группу журналов повтора.<BR>Удаляем ту, 
которая была corrupted, ее название видим из алерт-лога:<BR>ORA-00353: log 
corruption near block 99894 change 1926113366 time 01/27/2009 
09:00:14<BR>ORA-00334: archived log: '/data2/TUGR/redo01.log'<BR>Удаляем:</P>
<P>SQL&gt; ALTER DATABASE clear unarchived LOGFILE group 1;<BR>Database 
altered.</P>
<P>SQL&gt; ALTER DATABASE drop&nbsp; LOGFILE group 1;<BR>Database altered.</P>
<P>SQL&gt; SELECT * FROM v$log;</P>
<P>&nbsp; GROUP#&nbsp;&nbsp;&nbsp; THREAD#&nbsp; SEQUENCE#&nbsp;&nbsp;&nbsp; 
BYTES&nbsp;&nbsp;&nbsp; MEMBERS&nbsp;&nbsp;&nbsp; ARC STATUS&nbsp;&nbsp; 
FIRST_CHANGE# FIRST_TI<BR>--------- ---------- ---------- ---------- ---------- 
--- ------------- ------- ---<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; 
52428800&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 NO&nbsp; 
CURRENT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1926113366 
27.01.09<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 
52428800&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 YES 
UNUSED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0 <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 
52428800&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 YES 
UNUSED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0</P>
<P>7) Останавливаем БД (shut immediate).<BR>SQL&gt; shutdown 
immediate;<BR>Database closed.<BR>Database dismounted.<BR>ORACLE instance shut 
down.</P>
<P>8) Удаляем из файла параметров (pfile) ранее добавленный параметр 
_ALLOW_RESETLOGS_CORRUPTION=TRUE.<BR>Удаляем из pfile (init.ora в&nbsp; 
/opt/oracle/admin) добавленную ранее строку. <BR>9) Выполняем старт БД в режиме 
Mount (Startup Mount) с использованием модифицированного pfile<BR>SQL&gt; 
startup mount pfile=’/opt/oracle/admin/init.ora’<BR>ORACLE instance started.</P>
<P>Total System Global Area&nbsp; 444596224 bytes<BR>Fixed 
Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1219904 bytes<BR>Variable 
Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
117441216 bytes<BR>Database 
Buffers&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 322961408 
bytes<BR>Redo 
Buffers&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
2973696 bytes<BR>Database mounted.</P>
<P>10) Пересоздаем серверный файл параметров spfile <BR>SQL&gt; create spfile 
from pfile='/opt/oracle/admin/init.ora';</P>
<P>File created.</P>
<P>11) Выполняем останов БД <BR>SQL&gt; shutdown immediate<BR>ORA-01109: 
database not open</P>
<P>Database dismounted.<BR>ORACLE instance shut down.</P>
<P>12) Выполняем старт БД в обычном режиме (c spfile)<BR>SQL&gt; 
startup<BR>ORACLE instance started.</P>
<P>Total System Global Area&nbsp; 444596224 bytes<BR>Fixed 
Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1219904 bytes<BR>Variable 
Size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
117441216 bytes<BR>Database 
Buffers&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 322961408 
bytes<BR>Redo 
Buffers&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
2973696 bytes<BR>Database mounted.<BR>Database opened.</P>
<P>Для промышленной БД, для которой делаются регулярные backup, после открытия с 
опцией OPEN RESETLOGS все предыдущие бэкапы теряют актуальность. Поэтому надо 
сделать новый полный бэкап. <BR>Примечание: Если по каким-то причинам бэкапов у 
нас не делается, то шаги 13, 14 и 15&nbsp; пропускаем. Если БД находится в 
режиме ARCHIVELOG и настроено автоматическое выполнение бэкапов, также можно 
пропустить шаги 13, 14 и 15.&nbsp; <BR>13) shutdown immediate<BR>14) Take the 
cold backup.<BR>15) startup</P>
<P>Для повышения надежности при создании БД необходимо: <BR>1. 
Мультиплексировать управляющие файлы и файлы отката. При этом 
мультиплексированные файлы должны находиться на разных дисках. <BR>2. Для 
хранения файлов БД использовать средства резервирования дисков (зеркалирование, 
RAID). <BR>3. Сохранять копии системных файлов Oracle </P>
<P>Init*.ora, orapw*, listener.ora, tnsnames.ora, sqlnet.ora <BR>1. Сохранять 
копию управляющего файла, сделанную командой </P>
<P>alter system backup control file. <BR>При изменениях в СУБД (добавлении 
удалении файлов, табличных пространств) необходимо обновлять копию. <BR>При 
использовании конфигураций с несколькими серверами копии необходимо иметь для 
каждого сервера. <BR>Для исключения потерь данных БД должна работать в режиме 
ARCHIVELOG.</P>
<P><BR>Общие вопросы</P>
<P>Вопрос: Где находится файл логов Oracle alert.log?<BR>Ответ: На машине БДТИ 
зайти под пользователем oracle в 
директорию<BR>/opt/oracle/Admin/Имя_базы/bdump/alert.log</P>
<P>Вопрос: Где посмотреть и исправить переменные среды Oracle?<BR>Ответ: В файле 
/etc/profile.d/oracle.sh<BR>После исправления в файле необходимо перегрузить 
oracle.</P>
<P>Вопрос: Как остановить работу базы данных?<BR>Ответ: Выполнить 
последовательно следующие действия:<BR>Зайти на машину под пользователем oracle, 
выполнить команды:<BR>sqlplus <A 
href="mailto:sys/passme@имя_БД">sys/passme@имя_БД</A> as sysdba<BR>shutdown 
immediate (или shutdown normal)<BR>shutdown normal – останов БД, если нет 
текущих пользователей / клиентов Oracle<BR>shutdown immediate – останавливает БД 
с остановом всех открытых сессий<BR>Проверить, остановилась ли требуемая база 
данных можно под пользователем root, выполнением команды /etc/init.d/oracle 
status</P>
<P>Вопрос: Как можно уменьшить файл в tablespace?<BR>Ответ: Заходим в Toad по 
SYS или SYSTEM на вкладку Tablespace. Дважды щелкаем по файлу (панель справа), 
размеры которого хотим уменьшить:</P>
<P>Нажимаем кнопку Minimum Size?</P>
<P>Подставляем полученное значение в поле Datafile size, нажимаем 
Execute.<BR>ПРИМЕЧАНИЕ: часто непомерно разрастается файл табличного 
пространства UNDOTS01 – его можно уменьшать, но не менее чем до размера 400-500 
Мб. Аналогично для табл. пространства TЕMP.<BR>Вопрос: Как изменить пароль 
пользователя oracle?<BR>Ответ: ALTER USER &lt;имя_пользователя&gt; IDENTIFIED BY 
&lt;new_password&gt;;</P>
<P>Вопрос: Ошибка при создании tablespaces в БД.</P>
<P>Ответ: Причина – не хватает места на диске (указан больший размер datafile 
опцией SIZE, чем имеющегося свободного пространства на диске). Что делать:<BR>1) 
Посмотрите, возможно ли разместить datafile на другом дисковом пространстве. Все 
дисковые пространства на машине можно посмотреть командой df, на выходе будет 
список всех файловых систем, объем всего и свободного пространства по каждому 
пространству, перечень точек монтирования файловых систем.<BR>2) Уменьшите 
размер tablespaces через опцию SIZE таким образом, чтобы на данную машину 
поместились все необходимые пространства.<BR>3) Если не прошли предыдущие 
варианты – данная машина не обладает достаточным пространством для 
разворачивания БД. Замените её.</P>
<P>Вопрос: В alert.log шибка: &gt;&gt;&gt;&gt; ERROR IN KQLMBIVG SEE LCK TRACE 
FILE &lt;&lt;&lt; Что она означает и как её исправить?<BR>Ответ: Это баг 
(внутренний) Oracle, связанный с упорядочиванием блокировок/защелок на строки 
таблиц для кластерных конфигураций (RAC). На металинке пишут, что он присущ 
версии 10.2.0.2 , но решен в 10.2.0.3 и более поздних (10.2.0.4 и 
11g)<BR>Насколько я понимаю, он не так чтобы сильно критичен для работы БД на 
кластере, но, к некоторому притормаживанию, видимо, приводит.</P>
<P>Вопрос: На некоторых БД табличные пространства имеют следующие файлы: 
rsdu_ind.254.649609775. При попытке создать в табличном пространстве такой файл 
скриптом возникает ошибка: ORA-01276: Невозможно добавить файл 
+DATA/rsdu/datafile/rsdu_ind.254.649609775.&nbsp; Файл имеет имя Oracle Managed 
Files. Что делать?<BR>Ответ: Подобные файлы создавались через Managed Files. 
Т.е. при создании файла надо поставить галочку «Add Oracle Managed Files» и не 
определять имя файла, Oracle сам его сконфигурирует. Либо задать другое 
имя&nbsp; - без цифирок, например:&nbsp; rsdu_ind01.dbf.</P>
<P>22.06.2009 Ярыгина<BR>Вопрос: что делать, если были проанализированы 
системные логи и выяснено, что работа резервного узла БДТИ была прекращена из-за 
расхождения часов на узлах кластера <BR>Кластерное ПО Oracle очень критично к 
расхождению времени между узлами кластера.<BR>По логу резервного узла БДТИ 
видно, что он перегрузился принудительным выключением: то есть в логе вообще 
сведений нет типа "ошибка - от нее умираю" или "команда-тогда 
выключаюсь",&nbsp;а такое возможно либо в случае когда сбой питания (нажали 
кнопку, выдернули из розетки),либо - и это именно наш случай - получена команда 
от кластерных сервисов, что узел умер (не ответил вовремя на команду опроса по 
проверке "живости" узлов кластера), и надо его срочно вырубить (и перезагрузить 
без скидывания чего-либо на диск, дабы он чего-нибудь ненужного не записал на 
общие диски и всю базу не испортил этим).<BR>Ответ:<BR>С Yast описанная проблема 
с настройкой даты и времени возможна в следующих случаях:</P>
<P>1. Аппаратные часы разошлись с часами ядра linux.<BR>&nbsp; &nbsp;Решение 
данной проблемы описано в разделе техподдержки на сайте Novell:<BR>&nbsp; 
&nbsp;<A 
href="http://www.novell.com/support/search.do?cmd=displayKC&amp;docType=kc&amp;externalId=3167373">http://www.novell.com/support/search.do?cmd=displayKC&amp;docType=kc&amp;externalId=3167373</A><BR>2. 
В настройках Yast Даты и времени системные (hardware) часы установлены в 
локальное время (local time). В этом случаем даже в случае отмены, Yast все 
равно задает системное время, которое интерпретирует всегда как UTC (даже если 
установлено в локальное).</P>
<P>Для исправления проблемы следует выполнить следующие действия на обоих узлах 
кластера БДТИ:<BR>1. В настройках yast - Date and Time (Даты и времени) - 
следует указать, что Hardware Clock Set To&nbsp;UTC&nbsp;(Установить системные 
часы UTC).<BR>2. Следуя указаниям решения проблемы от Novell:<BR>&nbsp; 1) 
Открыть консоль в режиме суперпользователя (root).<BR>&nbsp; 2) Сконфигурировать 
часовой пояс при помощи команды&nbsp;tzselect<BR>&nbsp; 3) Установить системное 
время командой<BR>&nbsp; &nbsp; &nbsp; &nbsp;date -s "YYYY-MM-DD 
hh:mm:ss"<BR>&nbsp; 4) Удалить файл&nbsp;/etc/adjtime:<BR>&nbsp; &nbsp; &nbsp; 
&nbsp;rm /etc/adjtime<BR>&nbsp; &nbsp; &nbsp; &nbsp;(файл будет впоследствии 
пересоздан автоматически)<BR>&nbsp; 5) Установить аппаратные часы (также 
известные как RTC, часы BIOS или CMOS):<BR>&nbsp; &nbsp; &nbsp; &nbsp;hwclock 
--debug --systohc --utc<BR>&nbsp; 6) Повторить шаги 4) and 5) еще раз.<BR>3. 
Перезапустить демон NTP для точной коррекции времени:<BR>&nbsp; &nbsp; &nbsp; 
&nbsp;/etc/init.d/ntp restart<BR>&nbsp; Результат должен быть 
следующим:<BR>&nbsp; &nbsp; &nbsp; &nbsp;Shutting down network time protocol 
daemon (NTPD) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;&nbsp;done<BR>&nbsp; &nbsp; &nbsp; &nbsp;Try to get initial date and time 
via NTP from 192.168.10.124 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;done<BR>&nbsp; 
&nbsp; &nbsp; &nbsp;Starting network time protocol daemon (NTPD) &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp;done<BR>4. Проверить текущее время командой&nbsp;date.<BR>5. Запустить 
Yast - настройки Даты и времени, отменить, выйти и еще раз проверить текущее 
время командой&nbsp;date.<BR>&nbsp; Время должно соответствовать реальному.</P>
<P>19.07.2010 Ликунова<BR>Вопрос: что делать, если срок службы батарейки на 
дисковом массиве кончился?<BR>Данная батарейка обеспечитает резервирование кэша 
в оперативной памяти контроллера. В случае её неисправности отключится 
кэширование записей.<BR>Теоретически отсутствие баратеи приведет с замедлению 
операций с рейдом – замедление операций вставки, чтения и т.д. Более ничего не 
должно произойти.<BR>Необходимо на всякий случай сделать полный бэкап БД.</P>
<P><BR>Вопросы, связанные с подключением к БД (listener и др.)<BR>Вопрос: При 
попытке приконнектиться к базе sqlplus <A 
href="mailto:test/test@database">test/test@database</A>, выдается сообщение: 
<BR>ORA-12505 TNS:listener could not resolve SID diven in<BR>Ответ: возможно, 
нет файла listener.ora. Надо создать по аналогии с другими БД. После этого 
запустить листенер:<BR>$ORACLE_HOME\lsnrctl stop <BR>$ORACLE_HOME\lsnrctl 
start<BR>Также возможно, что файле tnsnames.ora неправильно указано SERVICE_NAME 
базы.<BR>Узнать, какой точно SERVICE_NAME, можно следующим образом:<BR>1)&nbsp; 
подключиться в Putty к серверу (под оracle);<BR>2)&nbsp; запустить sqlplus / as 
sysdba (если на сервере несколько баз, сначала выполнить export 
ORACLE_SID=);<BR>3) выполнить запрос <BR>SELECT VALUE FROM v$parameter WHERE 
NAME LIKE 'service_names';</P>
<P>Вопрос: Были заменены библиотеки ORACLE (libocci.so.10.1, libocci10.a). 
Машина перезапущена. При попытке стартовать listener выдается сообщение: 
TNS-12537, TNS-12560, TNS-00507</P>
<P>LSNRCTL&gt; start<BR>Запуск&nbsp;&nbsp; 
"/opt/oracle/product/10.2/db_1/bin/tnslsnr": пожалуйста, 
ждите...<BR>&nbsp;TNS-12537: TNS:соединение закрыто<BR>&nbsp;TNS-12560: 
TNS:ошибка адаптера протокола<BR>&nbsp;TNS-00507: Соединение 
закрыто<BR>&nbsp;&nbsp; Linux Error: 29: Illegal seek</P>
<P>Ответ: Нужно перелинковать запускаемые файлы oracle 
командой:<BR>$ORACLE_HOME/bin/relink all<BR>После этого перезапустите 
listener.</P>
<P>Вопрос: При попытке стартовать listener выдается сообщение: 
<BR>ORACLE_HOME_LISTENER is not SET, unable to auto-start Oracle Net 
Listener<BR>Ответ: в /opt/oracle/product/10.2/db_1/bin отредактировать 
dbstart:<BR>ORACLE_HOME_LISTENER=$1<BR>на<BR>ORACLE_HOME_LISTENER=$ORACLE_HOME</P>
<P>Вопрос: При попытке приконнектиться к базе sqlplus <A 
href="mailto:test/test@database">test/test@database</A>, выдается 
сообщение:&nbsp; ORA-12505, ORA-12519, ORA-12541 TNS</P>
<P>ORA-12505 TNS:listener could not resolve SID diven in<BR>и/или<BR>ORA-12519 
TNS:no appropriate service handler found<BR>и/или<BR>ORA-12541 TNS:no listener 
</P>
<P>Ответ: если при этом подключение без указания @database&nbsp; на сервере 
(через терминал) происходит нормально, возможно, неправильно записан файл 
/etc/hosts. Проверить на сервере (в терминальном окне): <BR>&gt; tnsping 
sspidb2<BR>TNS Ping Utility for Linux: Version 10.2.0.1 –Production on 
12-NOV-2008 09:59:33<BR>…<BR>Attempting to 
contact<BR>(DESCRIPTION=(CONNECT_DATA=(SERVICE_NAME=sspidb2.ema.ru) 
(ADDRESS=(PROTOCOL=tcp)(HOST=212.17.7.22)(PORT=1521)))<BR>Проверяем листенер 
:<BR>&gt; cat $ORACLE_HOME/network/admin/listener.ora | grep 
ADDRESS<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(ADDRESS=(PROTOCOL=tcp)(HOST=192.168.10.132)(PORT=1521))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1))<BR>Видим несоответствие адресов (здесь 
выделено жирным шрифтом). <BR>Проверяем&nbsp; /etc/hosts, видим&nbsp; (здесь 
тольно значимые для нас строки):<BR>cat /etc/hosts | grep -v 
[#]<BR>…<BR>127.0.0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
localhost<BR>192.168.10.132&nbsp; sspidb2.ema.ru 
<BR>212.17.7.22&nbsp;&nbsp;&nbsp;&nbsp; sspidb2.ema.ru&nbsp; sspidb2<BR>Меняем 
hosts, чтобы было в следующем порядке <BR>192.168.10.132&nbsp; sspidb2.ema.ru 
sspidb2 <BR>212.17.7.22&nbsp;&nbsp;&nbsp;&nbsp; sspidb2.ema.ru&nbsp; 
<BR>127.0.0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; localhost<BR>Проверяем 
подключение к БД.</P>
<P>Вопрос: Соединение клиента с кластерной БД не всегда происходит с первого 
раза и вообще происходит через раз, при этом выдает ошибку ORA-12560 или 
ORA-12545. Что делать? <BR>Ответ: Обычно такое происходит из-за работы 
автобалансировки нагрузки между узлами кластера, когда они обращаются друг к 
другу по короткому имени, но возможны и др. ситуации. Для проверки можно 
использовать команду tnsping rsdu&nbsp; (где rsdu это общее описание подключения 
к кластерной БД в tnsnames.ora) - если будет проходить через раз, а через раз 
давать ошибку типа ORA-12560 или ORA-12545, значит, эта проблема у вас есть. 
Выполнить следующие действия по проверке и настройке работы балансировки 
нагрузки между узлами, (описанных также в нашей инструкции " "Установка СУБД 
Oracle 10gR2 RAC Standart Edition на SLES10.doc"&nbsp; (в конце документа, 
раздел «Функционирование БД»)<BR>1. Сначала проверяем, что в tnsnames.ora на 
клиенте прописаны vip-адреса узлов кластера и что клиент «знает» куда идти по 
этим адресам – т.е. они либо должны быть зарегистрированы на DNS-сервере, к 
которому обращается клиентская машина, либо прописаны в hosts на этом клиенте 
(c:\windows\system32\drivers\etc\hosts).</P>
<P>Пример tnsnames.ora на клиенте:<BR>RSDU =<BR>&nbsp; (DESCRIPTION 
=<BR>&nbsp;&nbsp;&nbsp; (FAILOVER = ON)<BR>&nbsp;&nbsp;&nbsp; (ADDRESS = 
(PROTOCOL = TCP)(HOST = 
rsdudb01vip.rsdu.ngres.ru)(PORT=1521))<BR>&nbsp;&nbsp;&nbsp; (ADDRESS = 
(PROTOCOL = TCP)(HOST = 
rsdudb02vip.rsdu.ngres.ru)(PORT=1521))<BR>&nbsp;&nbsp;&nbsp; (CONNECT_DATA 
=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SERVER = 
DEDICATED)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SERVICE_NAME = 
rsdu.rsdu.ngres.ru)<BR>&nbsp;&nbsp;&nbsp; )<BR>&nbsp; )</P>
<P>2. На сервере (под oracle): добавить в файлы tnsnames.ora на обоих узлах 
кластера описание локальных листенеров обоих узлов. Vip-адреса должны быть 
прописаны полностью, с именем домена.<BR>Описание локальных листенеров обоих 
узлов:<BR>LISTENER_RSDUDB01 =<BR>&nbsp; (ADDRESS_LIST =<BR>&nbsp;&nbsp;&nbsp; 
(ADDRESS = (PROTOCOL = TCP)(HOST = 
rsdudb01vip.rsdu.ngres.ru)(PORT=1521))<BR>&nbsp; )</P>
<P>LISTENER_RSDUDB02 =<BR>&nbsp; (ADDRESS_LIST =<BR>&nbsp;&nbsp;&nbsp; (ADDRESS 
= (PROTOCOL = TCP)(HOST = rsdudb02vip.rsdu.ngres.ru)(PORT=1521))<BR>&nbsp; )</P>
<P>3. В серверный файл параметров добавить определения локальных листенеров 
последовательно для&nbsp; каждого из узлов кластера следующим образом:</P>
<P>На сервере (на одном из узлов кластера под oracle):<BR>sqlplus /nolog</P>
<P>--подсоединяемся к первому узлу:<BR>conn <A 
href="mailto:sys/syspassme@rsdu1">sys/syspassme@rsdu1</A> as sysdba<BR>alter 
system set LOCAL_LISTENER='LISTENER_RSDUDB01' scope=BOTH sid='rsdu1'; </P>
<P>--подсоединяемся к второму узлу:<BR>conn <A 
href="mailto:sys/syspassme@rsdu2">sys/syspassme@rsdu2</A> as sysdba<BR>alter 
system set LOCAL_LISTENER='LISTENER_RSDUDB02' scope=BOTH sid='rsdu2'; </P>
<P>Теперь соединение на клиенте должно быть стабильное. <BR>Проверяем 
правильность функционирования механизма балансировки нагрузки так: несколько раз 
подсоединяемся в sqlplus к общему определению БД на кластере (которое с 
балансировкой нагрузки) - и смотрим, к какому именно экземпляру (узлу) произошло 
подключение - должны быть случайным образом то первый, то второй узел 
кластера.<BR>conn <A 
href="mailto:system/passme@rsdu">system/passme@rsdu</A><BR>select instance_name 
from v$instance;<BR>Полезным является также результат выполнения 
запроса<BR>SELECT inst_id, count(inst_id) count_session<BR>FROM gv$session t , 
db_s_users d<BR>WHERE t.USER# = d.db_id (+)<BR>&nbsp; AND type = 'USER'<BR>GROUP 
BY inst_id; <BR>который выводит информацию, сколько пользовательских сессий 
клиентов РСДУ на каждом узле. Запрос может быть выполнен после полной установки 
БДТИ. Если количество сессий на каждом узле одинаковое, то это говорит о верной 
балансировке нагрузки между узлами. </P>
<P><BR>Вопрос: Через ODBC на клиентской машине (в тесте ODBC или в appbar) 
подключение к кластерной БД не всегда происходит с первого раза и вообще 
происходит через раз, при этом выдает ошибку ORA-12560 или ORA-12545. Что 
делать? <BR>Ответ: это связано с работой автобалансировки нагрузки между узлами 
кластера, требуется прописывание ини-параметров LOCAL_LISTENER для обоих 
экземпляров узлов кластера ( см. ответ на предыдущий вопрос. Действия те же 
самые) </P>
<P><BR>Вопросы, связанные с репликацией&nbsp; (2-х. и 3-х серв. конфигурация 
комплекса)<BR>Вопрос: при попытке добавить Master Site в репликацию возникает 
ошибка: ORA-ORA-23357: the propagator does not exist<BR>Ответ: Cause: The 
propagator does not exist. Action: Register a new propagator. <BR>Этим 
пропагатором является repadmin. Надо на двух серверах под sys выполнить команду: 
<BR>execute 
dbms_defer_sys.register_propagator(username=&gt;'REPADMIN');<BR>Чтобы узнать, 
кто у нас пропагатор, и есть ли он, надо выполнить запрос:<BR>select 
<BR>&nbsp;&nbsp; username, <BR>&nbsp;&nbsp; status<BR>from <BR>&nbsp;&nbsp; 
defpropagator;</P>
<P>Вопрос: Как удалить МНОЖЕСТВЕННЫЕ ошибки реплики <BR>Ответ: Выполнить из под 
REPADMIN <BR>BEGIN<BR>&nbsp;DBMS_DEFER_SYS.DELETE_ERROR( null, 
null);<BR>END;<BR>/<BR>COMMIT;</P>
<P><BR>Вопросы, связанные с кластерными БД (RAC)<BR>Вопрос: При инсталляции 
ClusterWare - при выполнении скрипта root.sh завершается с ошибкой 
создания&nbsp; Oracle Cluster Registry (OCR). Что делать?<BR>Это – результат 
того, что скрипт обнаружил на дисковой стойке следы предыдущей инсталляции 
Clusterware. В этом случае обрываем инсталляцию Clusterware. Необходимо 
пересоздать логические диски на дисковой стойке. Форматирование дисков, даже 
всех 3-х не поможет.</P>
<P>Вопрос: При инсталляции ClusterWare - при выполнении скрипта root.sh из него 
автоматом не стартует vipca. И вобще vipca не стартует. &nbsp;Что 
делать?<BR>Ответ: <BR>1. Отредактировать (под oracle)&nbsp; файл&nbsp; vipca в 
папке $ORA_CRS_HOME/bin следующим образом:&nbsp; <BR>&nbsp; после строк 
<BR>&nbsp;&nbsp;LD_ASSUME_KERNEL=2.4.19<BR>&nbsp;&nbsp;export&nbsp;LD_ASSUME_KERNEL<BR>&nbsp; 
добавить <BR>&nbsp;&nbsp;&nbsp; unset&nbsp;LD_ASSUME_KERNEL<BR>Проверить и при 
необходимости выполнить то же самое на другом узле кластера.<BR>2. Выполнить 
проверку (под root) (обычно актуально для второго узла 
кластера):<BR>$ORA_CRS_HOME/bin/oifcfg getif<BR>Если команда ничего не 
возвращает, - а ожидаемый результат такой: <BR>eth0&nbsp; 192.168.51.0&nbsp; 
global&nbsp; public<BR>eth1&nbsp; 10.0.0.0&nbsp; global&nbsp; 
cluster_interconnect<BR>то vipca не смог выполниться из скрипта root.sh. Поэтому 
выполняем команды: <BR>cd 
$ORA_CRS_HOME/bin<BR>./oifcfg&nbsp;setif&nbsp;-global&nbsp;eth0/192.168.51.0:public&nbsp;<BR>./oifcfg&nbsp;setif&nbsp;-global&nbsp;eth1/10.0.0.0:cluster_interconnect&nbsp;<BR>Проверяем 
результат командой&nbsp; oifcfg getif. <BR>3. Затем&nbsp; нужно либо выполнить 
root.sh повторно, либо вызвать vipca и выполнить необходимые действия в нем: 
указать vip-адрес узла IP Alias Name (с доменом)&nbsp; и его vip IP-адрес, затем 
нажать "Next" и "Finish". В конце работы vipca должно появится&nbsp; сообщение, 
что созданы сервисы&nbsp; GSD, ONS и VIP. И только после этого можно считать 
скрипт root.sh выполненным.</P>
<P>Вопрос: При перезагрузке узла не стартуют автоматически кластерные 
сервисы.<BR>При проверке состояния <BR>$ORA_CRS_HOME/bin/crsctl check 
crs<BR>видим, что сервисы CSS, CRS, EVM не загружены<BR>Ответ: Если тем не менее 
кластерные сервисы отлично стартуют вручную - командой из под root 
<BR>$ORA_CRS_HOME/bin/crsctl start crs<BR>то необходимо в файле /etc/inittab 
передвинуть строки запуска cssd, crsd, evmd из конца файла (куда они добавляются 
инсталлятором) выше, а именно перед запуском 3 
уровня:<BR>l0:0:wait:/etc/init.d/rc 0<BR>l1:1:wait:/etc/init.d/rc 
1<BR>l2:2:wait:/etc/init.d/rc 2<BR># Starting Cluster Deamon for 
ASM<BR>h1:35:respawn:/etc/init.d/init.evmd run &gt;/dev/null 2&gt;&amp;1 
&lt;/dev/null<BR>h2:35:respawn:/etc/init.d/init.cssd fatal &gt;/dev/null 
2&gt;&amp;1 &lt;/dev/null<BR>h3:35:respawn:/etc/init.d/init.crsd run 
&gt;/dev/null 2&gt;&amp;1 &lt;/dev/null<BR>l3:3:wait:/etc/init.d/rc 
3<BR>#l4:4:wait:/etc/init.d/rc 4<BR>l5:5:wait:/etc/init.d/rc 
5<BR>l6:6:wait:/etc/init.d/rc 6</P>
<P>Вопрос: При перезагрузке узла не стартует автоматически экземпляр 
БД.<BR>Ответ:<BR>1. Выполните проверку по предыдущему вопросу – что 
автоматически стартуют кластерные сервисы.<BR>2. Проверьте результат выполнения 
команды set | grep ORACLE_SID <BR>Убедитесь, что файле /etc/profile.d/oracle.sh 
правильно установлена переменная среды, определяющая имя экземпляра БД 
(ORACLE_SID). Для 1-ого и 2-ого узлов кластера это должно быть соответственно 
RSDU1 и RSDU2 либо rsdu1 и rsdu2 – т.е. прибавляются цифирки к уникальному имени 
БД (RSDU или rsdu). Внимание: регистр букв имеет значение! Если вы не уверены в 
регистре, посмотрите на название файла alert_&lt;SID&gt;.log в папке 
/opt/oracle/admin/RSDU/bdump. <BR>3. Проверьте, что в файле /etc/oratab 
используется правильное наименование экземляров БД и ASM и что для них указано Y 
– стартовать автоматически, а не N - не стартовать. Пример содержания файла для 
1-ого узла 
кластера:<BR>+ASM1:/opt/oracle/product/10g:Y<BR>RSDU1:/opt/oracle/product/10g:Y<BR>4. 
Проверьте, что в файле /etc/sysconfig/oracle изменено значение "no" на&nbsp; 
"yes" для строк <BR>START_ORACLE_DB="yes" <BR>START_ORACLE_DB_LISTENER="yes" 
<BR>5. Если после этого Oracle все равно не стартует при перезагрузке, то идем 
таким путем:<BR>5.1) Убираем запуск /etc/init.d/oracle на уровнях 3, 5 (через 
Yast, или удаляя ссылки из /etc/init.d/rc3, /etc/init.d/rc5).<BR>5.2) Добавляем 
запуск oracle в /etc/inittab, после запуска кластерных сервисов (4-ой 
строкой):</P>
<P>h1:35:respawn:/etc/init.d/init.evmd run &gt;/dev/null 2&gt;&amp;1 
&lt;/dev/null<BR>h2:35:respawn:/etc/init.d/init.cssd fatal &gt;/dev/null 
2&gt;&amp;1 &lt;/dev/null<BR>h3:35:respawn:/etc/init.d/init.crsd run 
&gt;/dev/null 2&gt;&amp;1 &lt;/dev/null<BR>h4:35:once:/etc/init.d/oracle start 
&gt;/dev/null 2&gt;&amp;1 &lt;/dev/null</P>
<P>Если после перезапуска Oracle опять не стартовал, то выполнить команды:<BR>ps 
-A | grep css<BR>4120 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00:01:17 
init.cssd<BR>4800 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00:00:00 
init.cssd<BR>4919 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00:00:16 
ocssd.bin</P>
<P>ps -A | grep d.bin<BR>4121 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
00:00:34 crsd.bin<BR>4815 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00:00:03 
evmd.bin<BR>4919 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00:00:16 
ocssd.bin</P>
<P>Если результат выполнения не аналогичен, хоть один процесс отсутствует – 
значит, кластерное ПО (не Oracle) работает некорректно. Соответственно – Oracle 
не может стартовать.<BR>В этом случае читаем лог, пляшем с бубном и т.п. Или по 
быстренькому все переинсталлируем, начиная с Линуха.</P>
<P>Вопрос: Как посмотреть состояние кластерных демонов на узле кластерной БД 
?<BR>Ответ: $ORA_CRS_HOME/bin/crsctl check crs</P>
<P>Вопрос: Как остановить/запустить кластерные демоны на узле кластерной БД 
?<BR>Ответ: <BR>1. для останова выполнить под root команду&nbsp; 
$ORA_CRS_HOME/bin/crsctl stop crs<BR>ВНИМАНИЕ! – если БД работает, то сначала 
надо остановить все службы кластерной БД (см. следующие 2 вопроса)<BR>2. для 
запуска выполнить под root команду&nbsp; $ORA_CRS_HOME/bin/crsctl start crs</P>
<P>Вопрос: Как посмотреть состояние всех служб кластерной БД (всех 
узлов)?<BR>Ответ: $ORA_CRS_HOME/bin/crs_stat –t</P>
<P>Вопрос: Как остановить/запустить все сервисы кластерной БД вручную?<BR>Ответ: 
узлы называются rsdudb01 и rsdudb02, тогда:<BR>1. для останова последовательно 
выполнить команды (под oracle)<BR>srvctl stop database –d rsdu<BR>srvctl stop 
asm –n rsdudb01<BR>srvctl stop asm –n rsdudb02<BR>srvctl stop nodeapps –n 
rsdudb01<BR>srvctl stop nodeapps –n rsdudb02</P>
<P>2. для запуска последовательно выполнить команды (под oracle)<BR>srvctl start 
nodeapps –n rsdudb01<BR>srvctl start nodeapps –n rsdudb02<BR>srvctl start asm –n 
rsdudb01<BR>srvctl start asm –n rsdudb02<BR>srvctl start database –d rsdu</P>
<P>Вопрос: Как остановить/запустить отдельный экземпляр кластерной БД 
вручную?<BR>Ответ: Пример останова экземпляра БД на первом узле (узел rsdudb01, 
экземпляр rsdu1) – выполнить следующую команду под oracle:<BR>srvctl stop 
instance –d rsdu –i rsdu1</P>
<P>Для запуска соответственно выполнить следующую команду под oracle:<BR>srvctl 
start instance –d rsdu –i rsdu1</P>
<P>Вопрос: При использовании команды srvctl она не выполняется и при этом выдает 
ошибку «error while loading shared libraries». Что делать?<BR>Ответ:&nbsp; 
Отредактировать (под oracle)&nbsp; файл&nbsp; srvctl в папках $ORACLE_HOME/bin и 
$ORA_CRS_HOME/bin следующим образом:&nbsp; <BR>&nbsp; после строк <BR>#Remove 
this workaround when the bug 3937317 is 
fixed<BR>LD_ASSUME_KERNEL=2.4.19<BR>export LD_ASSUME_KERNEL<BR>&nbsp; добавить 
<BR>unset&nbsp;LD_ASSUME_KERNEL&nbsp;&nbsp;<BR>Проверить и при необходимости 
выполнить то же самое на другом узле кластера.</P>
<P>Вопрос: После изменения IP–адресов узла кластера не стартует БД. Что делать? 
Как изменить vip-IP узла?<BR>Ответ: Изменение VIP адреса или IP после создания 
кластерных сервисов и БД должно пройти перерегистрацию в OCR. Для этого 
используем утилиту srvctl modify nodeapps с опцией -A 
&lt;new_vip_address&gt;&nbsp; - она необходима,&nbsp; если возникла 
необходимость изменить имя, IP или маску сети для существующего VIP-адреса узла. 
Использовать следующую команду:<BR>srvctl modify nodeapps -n rsdudb01 -A 
100.200.300.40/255.255.255.0/eth0<BR>где 100.200.300.40 – новый vip-адрес 
узла</P>
<P>Вопрос: Как добавить управляющий файл (controlfile) / сделать дублирование 
управляющего файла для кластерной БД, для которой используется ASM-хранилище? 
<BR>Ответ: При инсталляции кластерной БД по умолчанию создается 1 управляющий 
файл, иногда (поскольку это рекомендуется Oracle) продвинутый заказчик просит 
сделать дублирование. ВНИМАНИЕ – эта задача требует останова – перезапуска всей 
БД. Делаем так:<BR>1.&nbsp; Остановить один из экземпляров (все кроме одного), и 
работать с оставшегося. </P>
<P>2. Выяснить текущее расположение управляющего файла <BR>select name from 
v$controlfile; <BR>например, получаем </P>
<P>NAME 
<BR>-------------------------------------------------------------------------------- 
<BR>+DATA/rsdu/controlfile/current.260.676549293 </P>
<P>3. Изменить spfile относительно параметра control_files. В этом примере, 
второй controlfile <BR>предполагается создать на той де дисковой группе DATA 
(Внимание – если есть др. дисковая группа, +DATA1, то лучше на ней). <BR>Для 
этого подключаемся в терминале к БД и выполняем команду изменения параметра:</P>
<P>sqlplus sys/passme as sysdba <BR>alter system set 
control_files='+DATA/rsdu/controlfile/current.260.676549293', '+DATA' 
scope=spfile sid='*'; </P>
<P>т.е. указываем для него найдено ранее (в п.2) название существующего 
управляющего файла и добывляем еще один ('+DATA', его точное название мы пока не 
знаем.)</P>
<P>4. Перестартовать экземпляр в режиме NOMOUNT. </P>
<P>shutdown immediate <BR>startup nomount <BR>exit </P>
<P>5. С помощью rman дублируем&nbsp; controlfile&nbsp; (либо закрыть здесь 
sqlplus, либо&nbsp; в др. окне терминала, тоже под oracle)</P>
<P>$ORACLE_HOME/bin/rman target sys/passme nocatalog <BR>После появления 
приглашения RMAN&gt;&nbsp; выполняем команду </P>
<P>restore controlfile from '+DATA/rsdu/controlfile/current.260.676549293'; </P>
<P>Результатом выполнения будет что-то вроде: </P>
<P>Запуск restore в =10.02.2009 14:28:44 <BR>занятый канал: ORA_DISK_1 <BR>канал 
ORA_DISK_1: sid=312 экземпляр=rsdu2 devtype=DISK </P>
<P>канал ORA_DISK_1: скопирована копия управляющего файла <BR>имя выходного 
файла=+DATA/rsdu/controlfile/current.260.676549293 <BR>имя выходного 
файла=+DATA/rsdu/controlfile/current.290.678464931 <BR>Завершение restore в 
=10.02.2009 14:28:57 </P>
<P>Имя нового controlfile будет «придумано» самим ASM 
<BR>+DATA/rsdu/controlfile/current.290.678464931 <BR>Закрыть rman (exit).</P>
<P>6. вернуться / войти (sqlplus sys/passme as sysdba) в sqlplus и смонтировать 
и открыть базу: <BR>alter database mount; <BR>alter database open; </P>
<P>7. Проверить что существуют оба controlfiles - нам нужно получить оба их 
названия : </P>
<P>select name from v$controlfile; </P>
<P>NAME 
<BR>-------------------------------------------------------------------------------- 
<BR>+DATA/rsdu/controlfile/current.260.676549293 
<BR>+DATA/rsdu/controlfile/current.290.678464931 </P>
<P>8. Еще раз изменить инициализационный параметр control_file, теперь уже с 
указанием полного пути к новому файлу (прописать оба полных пути): </P>
<P>alter system set 
control_files='+DATA/rsdu/controlfile/current.260.676549293','+DATA/rsdu/controlfile/current.290.678464931' 
scope=spfile sid='*'; </P>
<P>9. Если есть возможность&nbsp; - сразу перестартовать БД <BR>shutdown 
immediate <BR>startup nomount </P>
<P>Все - для кластера поднять (startup) второй экземпляр. </P>
<P>Очкова<BR>Вопрос: Кроме EM консоли как посмотреть, сколько занято flash 
recovery area?<BR>Ответ: Под rsduadmin или sys<BR>select * from 
v$flash_recovery_area_usage<BR>Где расположена:<BR>SELECT inst_id || '.' || name 
|| ' = ' || value param<BR>&nbsp; FROM gv$parameter<BR>&nbsp;WHERE name LIKE 
'db_recover%'<BR>&nbsp;&nbsp;&nbsp; OR name LIKE 
'log_arc%1'<BR>&nbsp;&nbsp;&nbsp; OR name LIKE 
'log_arc%10'<BR>&nbsp;&nbsp;&nbsp; OR name LIKE 'log_arc%format'<BR>&nbsp;ORDER 
BY name, inst_id;</P>
<P>Очкова<BR>Вопрос: Как проверить, сколько дискового пространства свободно на 
дисковой стойке?<BR>Ответ: Под rsduadmin или sys выполнить запрос:<BR>select 
name||' = '||value,null MB,null GB from V$parameter WHERE (lower(name) like 
'%undo_tablespace') <BR>OR (lower(name) like 'instance_name')<BR>OR (lower(name) 
like 'instance_number')<BR>OR (lower(name) like 
'cluster_database_instances')<BR>UNION ALL<BR>SELECT 'Total SIZE:' FILE_IS_NAME, 
sum(mb) MB, Round(sum(mb)/1024,3) GB FROM <BR>(SELECT 
round(sum(f.bytes)/1024/1024) mb FROM V$DATAFILE f union all <BR>SELECT 
round(sum(t.bytes)/1024/1024) mb FROM v$tempfile t) union all<BR>SELECT 
name,round(bytes/1024/1024) mb,round(bytes/1024/1024/1024,3) GB FROM v$tempfile 
UNION ALL<BR>SELECT name ,round(bytes/1024/1024) 
mb,round(bytes/1024/1024/1024,3) GB FROM V$DATAFILE <BR>order by mb 
desc;<BR>Запрос выдаст не используемые, а зарезервированные объемы 
tablespaces!</P>
<P>Очкова<BR>Вопрос: Как перенести tablespace РСДУ с одной дисковой стойки DATA 
на другую DATA1?<BR>Ответ: На примере RSDU_ELARH_IND.&nbsp; Исполнять под 
SYS<BR>1. Сохранить скрипт создания табличного пространства (в Toad по команде 
Create script для табличного пространства).<BR>2. В Toad перейти на закладку 
индексы, отобрать по фильтру все индексы в табличном пространстве RSDU_ELARH_IND 
и сохранить для них скрипты создания (по команде Create script).<BR>Важно, чтобы 
скриты индексов сохранялись с именем схемы, в которой надо их создать - 
RSDU2ELARH в данном случае .<BR>3. Удалить в Toad пространство RSDU_ELARH_IND с 
опциями «include data files» и "Cascade constraints".<BR>4. Поскольку на таблицы 
в схеме RSDU2ELARH созданы уникальные ключи, то временно выключаем все 
constraints в этой схеме командой disable constraints.<BR>5. Для дальнейшей 
работы надо почистить корзину в схеме RSDU2ELARH (вкладка Recycle Bin командой 
Purge).<BR>4. Берем скрипт созданный в п. 1 для создания табличного пространства 
RSDU_ELARH_IND, заменяем в нем DATA на DATA1, выполняем.<BR>5. Без изменений 
выполняем скрипты, сохраненные в п. 2.<BR>Если это не критично для 
пользователей, то лучше truncate таблицы-стэки MEAS_ARC_29_6_VIEW_1, 
MEAS_ARC_29_6_VIEW_2 и т.д. Иначе скрипты создания индексов для этих таблиц 
будут очень долго выполняться.</P>
<P>27.01.2010 Ликунова (по письму Вагина)<BR>Вопрос: БД не открывается и в 
алерт-логе присутствует ошибка ORA-19815: WARNING: db_recovery_file_dest_size of 
107374182400 bytes is 100.00% used, and has 0 remaining bytes 
available.<BR>Ответ: <BR>Важно!!! Не забываем сделать необходимые шаги, 
описанные в инструкции по установке RAC, для того чтобы Oracle стартовал после 
перезагрузки любого хоста кластера (или одновременно двух узлов) - это внесение 
изменений в inittab. Замечу, что без этих изменений Oracle иногда стартует, 
только очень редко и очень долго. С изменениями - стартует 100%, примерно в 
течение минуты после загрузки узла (узлов).</P>
<P>БД сдохла после того как закончилось место на диске данных, который находится 
по управлением ASM.<BR>1. Свободное место на дисках под управлением ASM можно 
узнать следующим запросом.<BR>select name, total_mb, free_mb from 
v$asm_diskgroup<BR>2. Свободное место flash_recovery_area можно узнать следующим 
запросом:<BR>select * from v$flash_recovery_area_usage<BR>Если 
flash_recovery_area уже автоматически почистилась, то следующий шаг 3. Если 
flash_recovery_area забита, то следующий шаг 4.<BR>3. Как сделать удаление 
бэкапов rman, если Oracle не стартует (из-за того, что все место на диске 
забилось бэкапами).<BR>Войти под Oracle.<BR>Установить корректный 
ORACLE_SID<BR>Вызвать sqlplus /nolog<BR>connect sys/passme as sysdba;<BR>startup 
mount;<BR>Выйти в bash<BR>($ORACLE_HOME)/bin/rman target sys/passme <BR># 
Удалить все бэкапы старше 7 дней <BR>RMAN&gt;DELETE FORCE NOPROMPT OBSOLETE 
RECOVERY WINDOW OF 7 DAYS;<BR>4. Как почистить flash_recovery_area и сделать 
удаление бэкапов rman<BR>забилось бэкапами).<BR>Войти под Oracle.<BR>Установить 
корректный ORACLE_SID<BR>Вызвать sqlplus /nolog<BR>connect sys/passme as 
sysdba<BR>startup mount;<BR>Выйти в bash<BR>($ORACLE_HOME)/bin/rman target 
sys/passme <BR># rman "забудет", что делал бэкапы<BR>RMAN&gt;crosscheck 
archivelog all;<BR># rman физически удалит файлы архивных 
логов<BR>RMAN&gt;delete expired archivelog all;</P>
<P>&nbsp;</P>
<P>Порядок обновления ПО РВ РСДУ2 на серверах Linux<BR>Последовательность шагов 
для обновления клиента Oracle до версии 11.2 и программного обеспечения 
РСДУ2&nbsp; до актуальной версии. <BR>Установка клиента Oracle осуществляется с 
правами пользователя oracle, а выполнение общесистемных команд и установка ПО 
РСДУ2 – с правами пользователя root.<BR>1. Собираем текущую информацию о 
запущенном ПО РВ РСДУ2 на хостах комплекса РСДУ2: лог-файлы из /var/log/ema и 
конфигурационные файлы из /etc/ema/.<BR>2. Убедиться в том, что работаем на 
сервере находящемся в состоянии SLAVE (если имеются два дублирующих друг друга 
хоста в состоянии MASTER, например хосты БДТИ, тогда неважно с какого начинать 
работу)<BR># ema status<BR>==================================<BR>Checking for 
EMA processes 
started<BR>==================================<BR>lsmagentd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
running<BR>ssbsd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
running<BR>acsrvd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
running<BR>hgd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
running<BR>oicdcpd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
running<BR>sysmond&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
running<BR>==================================<BR>This slot is 
SLAVE!<BR>==================================<BR>Либо командой:<BR># ltime -l | 
grep slot<BR>This slot is SLAVE</P>
<P>3. Убедиться в том, что установленная&nbsp; операционная система&nbsp; SUSE 
Linux Enterprise Server 10 SP1 (i586) и при необходимости установить обновления 
ОС<BR>#cat /etc/issue<BR>Welcome to SUSE Linux Enterprise Server 10 SP1 (i586) - 
Kernel \r (\l).<BR>4. Убедиться в наличии swap минимальным размером 2*RAM<BR># 
free<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
total&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
used&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
free&nbsp;&nbsp;&nbsp;&nbsp; shared&nbsp;&nbsp;&nbsp; 
buffers&nbsp;&nbsp;&nbsp;&nbsp; 
cached<BR>Mem:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
1036604&nbsp;&nbsp;&nbsp; 1014436&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
22168&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 66032&nbsp;&nbsp;&nbsp;&nbsp; 861196<BR>-/+ 
buffers/cache:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
87208&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
949396<BR>Swap:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
4200956&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
80&nbsp;&nbsp;&nbsp; 4200876<BR>При отсутствии swap необходимо его добавить «на 
лету» выполнив следующие команды (для примера создается swap раздел размером 
2Гб):<BR># dd if=/dev/zero of=/swap2gb bs=1024k count=2000<BR># mkswap 
/swap2gb<BR># swapon /swap2gb<BR>Разрешить использование созданного файла как 
swap при запуске сервера, можно добавив в файл /etc/fstab следующие 
строки:<BR>/swap2gb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
swap &nbsp;swap&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
defaults&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
0 0<BR>5. Убедиться в наличии свободного места на диске сервера<BR>#df -h<BR>6. 
Убедиться в отсутствии в автозагрузке демона novell-zmd. Этот демон 
устанавливается автоматически при установке ОС и служит для обновления ПО SLES. 
Поскольку рабочие сервера не имеют доступа к сети Интернет, этот сервис 
необходимо удалить из автозагрузки. Для&nbsp; этого необходимо воспользоваться 
командой yast-&gt;System-&gt;System Services (Runlevel) и поставить «No» против 
сервиса&nbsp; novell-zmd&nbsp; в списке загрузки демонов runlevel. После этого 
можно почистить лог файлы (zmd-) этого демона в каталоге /var/log<BR>Для 
остановки сервиса без перезагрузки системы воспользуйтесь 
командой:<BR>#/etc/init.d/novell-zmd stop<BR>7. Убедиться в отсутствии в 
автозагрузке демона powersaved. Этот демон устанавливается автоматически при 
установке ОС и служит для управления параметрами электропитания и частотой 
процессора настольных компьютеров и ноутбуков. Поскольку для серверов это не 
актуально, да и большинство серверный процессоров не поддерживают изменение 
тактовой частоты, этот сервис необходимо удалить из автозагрузки. Для&nbsp; 
этого необходимо воспользоваться командой yast-&gt;System-&gt;System Services 
(Runlevel) и поставить «No» против сервиса&nbsp; powersaved&nbsp; в списке 
загрузки демонов runlevel.<BR>8. Проверить наличие (rpm –qa ) и&nbsp; при 
необходимости установить следующие пакеты, которые могут потребоваться при 
обновлении ораклового клиента (состав необходимых для установки пакетов может 
меняться в зависимости от версии исходной ОС):<BR>#rpm –i&nbsp; 
gd-2.0.32-23.2.i586.rpm&nbsp; <BR>#rpm –i&nbsp; 
plotutils-2.4.1-591.2.i586.rpm&nbsp; <BR>#rpm –i&nbsp; 
gnuplot-4.0.0-20.2.i586.rpm&nbsp; <BR>#rpm –i&nbsp; 
sysstat-6.0.2-16.19.i586.rpm<BR>Если не удается найти перечисленные пакеты на 
инсталляционном диске, их установка не обязательна.<BR>9. Разрешить удаленное 
администрирование сервера через клиента vnc. Для этого необходимо 
воспользоваться командой&nbsp; yast-&gt;Network Services -&gt;Remote 
Administration-&gt;Allow Remote Administration[x]<BR>После этих проверок можно 
приступать к обновлению ПО<BR>10. Если необходимо обновить клиента Oracle до 
актуальной версии (11.2) то копируем архив дистрибутива клиента oracle 
linux_11gR2_client.zip в каталог /opt/oracle/install и разархивируем его 
командой:<BR>#unzip linux_11gR2_client.zip<BR>11. Поскольку инсталлятор клиента 
oracle требует графического интерфейса&nbsp; необходимо запустить X клиента. 
Предварительно необходимо проверить, что ПО РСДУ2 запускается из уровня загрузки 
5:<BR># ls /etc/rc.d/rc5.d/*ema*<BR>/etc/rc.d/rc5.d/K20ema&nbsp; 
/etc/rc.d/rc5.d/S02ema<BR>Запускаем X клиента, переходя на уровень 5<BR>#init 
5<BR>12. Подключаемся как пользователь oracle к серверу через клиент vnc на порт 
5901<BR>13. В случае работы с хостом, отличным от хоста СУБД, рекомендуется 
выполнить удаление клиента Oracle 10ой версии с помощью стандартного 
деинсталлятора. Для хоста СУБД исходная версия клиента не удаляется, но 
параллельно, в отдельную директорию, устанавливается клиент Oracle 11ой 
версии.<BR>14. Запускаем инсталлятор клиента Oracle 11ой версии:<BR><A 
href="mailto:oracle@host:~>/opt/oracle/install/client">oracle@host:~&gt;/opt/oracle/install/client</A> 
/runInstaller<BR>Устанавливаем клиента Oracle&nbsp; 11.2 в каталог&nbsp; 
/opt/oracle/product/11g. Выбираем : <BR>* тип установки «Administrator»<BR>* 
поддержку английского и русского языка<BR>* Путь исправляем на 
/opt/oracle/product/11g (для сохранения единообразности можно выбрать другое 
название)<BR>* Игнорируем несовпадение версий glibc и sysstat<BR>* Если 
возникает вопрос о местонахождении каталога «oraInventory» то устанавливаем путь 
/opt/oracle/oraInventory11g<BR>В инсталляторе Client Oracle 11&nbsp; 
предлагается выполнить команду “Run and fix” при обнаружении несовпадений по 
требованиям перед непосредственном запуском установки клиента. Если клиент 
обновляется на хосте БД, этот скрипт не нужно выполнять, для других случаев его 
можно выполнить. Аналогично, в конце установки клиента, предлагается запустить 
на выполнение скрипт root.sh – его желательно запустить на выполнение, однако 
обратите внимание на то, что при обновлении хоста СУБД на вопросы о замене 
каких-либо файлов необходимо отвечать No (для хоста ОИК на все вопросы можно 
отвечать утвердительно).<BR>Убеждаемся, что клиент установлен без ошибок, 
подключаемся к серверу как пользователь root и переходим к конфигурированию 
доступа к БД и установке ПО РСДУ2<BR>15. Еще раз убеждаемся, что работаем на 
хосте РСДУ2 находящимся в состоянии slave. <BR>#ema status<BR>16. Выгружаем ПО 
РСДУ2<BR>#ema stop<BR>И убеждаемся, что оно выгрузилось <BR>#ema status<BR>17. 
Проверяем, чтобы загрузка сервера происходила в режиме 3 а не 5, для этого&nbsp; 
выполняем команду:<BR># cat /etc/inittab | grep 
:initdefault<BR>id:5:initdefault:<BR>При необходимости меняем режим загрузки 
yast-&gt;System-&gt;System Services (Runlevel)-&gt;(x)Expert mode-&gt; Set 
default runlevel after booting to:[ 3 Full multiuser with network]<BR>На хостах 
БДТИ пункты 18, 19 следует пропустить!!!<BR>18. На хостах БДРВ выполняем 
исправления в файле /etc/profile.d/oracle.sh путь на новый клиент Oracle в 
следующих 
строках:<BR>ORACLE_HOME=$ORACLE_BASE/product/11g<BR>AGENT_HOME=$ORACLE_BASE/product/11g_agent<BR>Затем 
необходимо закомментировать строку в начале файла (поставив вначале строки 
символ «#» ):<BR>#if [ `id -un` == "oracle" ]; then<BR>и комментируем последнюю 
строку файла:<BR>#fi<BR>19. Для того, что бы изменения, внесенные в файл 
/etc/profile.d/oracle.sh возымели действие, заходим под пользователем root 
заново или выполняем команду<BR>#su – root<BR>Убеждаемся, что пути в переменных 
окружения установлены правильно:<BR>#env | grep 
_HOME<BR>…<BR>AGENT_HOME=/opt/oracle/product/11g_agent<BR>ORACLE_HOME=/opt/oracle/product/11g</P>
<P>#env | grep 
LD<BR>…<BR>LD_LIBRARY_PATH=/opt/oracle/product/11g/lib:/opt/oracle/product/11g/ctx/lib<BR>20. 
Проверяем наличие и при необходимости создаем файл 
/opt/oracle/product/11g/network/admin/tnsnames.ora (пользователь:владелец&nbsp; 
oracle:oinstall) следующего содержимого:<BR>RSDU =<BR>(DESCRIPTION 
=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(CONNECT_TIMEOUT=20)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(TRANSPORT_CONNECT_TIMEOUT=20)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(ADDRESS_LIST 
=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(ADDRESS = (PROTOCOL = TCP)(HOST = rsdudb01vip.rsdu.tec_name.dvgk.ru)(PORT = 
1521))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(ADDRESS = (PROTOCOL = TCP)(HOST = rsdudb02vip.rsdu.tec_name.dvgk.ru)(PORT = 
1521))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (CONNECT_DATA 
=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(SERVICE_NAME= 
rsdu.tec_name.dvgk.ru)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(SERVER=DEDICATED)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<BR>)</P>
<P>RSDU1 =<BR>(DESCRIPTION=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(CONNECT_TIMEOUT=20)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(TRANSPORT_CONNECT_TIMEOUT=20)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(ADDRESS = (PROTOCOL=tcp)(HOST= 
rsdudb01vip.rsdu.tec_name.dvgk.ru)(PORT=1521))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(CONNECT_DATA=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(SERVICE_NAME= 
rsdu.tec_name.dvgk.ru)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(SERVER=DEDICATED)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<BR>)</P>
<P>RSDU2 =<BR>(DESCRIPTION=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(CONNECT_TIMEOUT=20)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(TRANSPORT_CONNECT_TIMEOUT=20)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(ADDRESS = (PROTOCOL=tcp)(HOST= 
rsdudb02vip.rsdu.tec_name.dvgk.ru)(PORT=1521))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(CONNECT_DATA=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(SERVICE_NAME= 
rsdu.tec_name.dvgk.ru)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
(SERVER=DEDICATED)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )<BR>) 
<BR>Где,<BR>rsdudb01vip.rsdu.tec_name.dvgk.ru vip-адрес основного сервера 
БД<BR>rsdudb02vip.rsdu.tec_name.dvgk.ru vip-адрес резервного сервера 
БД<BR>rsdu.tec_name.dvgk.ru имя сервиса БД<BR>21. Проверяем наличие и при 
необходимости создаем файл 
/opt/oracle/product/11g/network/admin/sqlnet.ora&nbsp; (пользователь:владелец o 
oracle:oinstall) следующего содержимого:<BR>NAMES.DIRECTORY_PATH= (TNSNAMES, 
EZCONNECT)<BR>ADR_BASE = /opt/oracle<BR>DIAG_SIGHANDLER_ENABLED = FALSE<BR>22. 
Проверяем соединение с сервером Oracle<BR>#tnsping RSDU<BR>23. Чистим лог-файлы 
в /var/log/ema<BR>24. Перемещаем устаревшие дистрибутивы РСДУ2 в директорию 
/root/!OLD<BR>25. Разархивируем архив с дистрибутивом ПО РСДУ2<BR>#tar&nbsp; 
-xjf RSDU2_linuxRT_XX-XX-XX_XX-XX-XX.tar.bz2<BR>26. Стандартный путь для 
размещения проектов РСДУ2 - /root/LinuxRT/trunk/<BR>27. Выполняем компиляцию и 
сборку модулей РВ РСДУ2<BR>ВНИМАНИЕ!!! Если производится установка ПО РСДУ на 
сервере, на котором установлена СУБД Oracle 10, то необходимо перед сборкой 
модулей настроить переменные окружения в файле /etc/ema/RSDU2ENV (пример файла – 
в дистрибутиве, в директории Scripts), и в директорию /usr/bin/&nbsp; 
скопировать файл RSDU2 (включив для него биты исполнения), поскольку ПО РСДУ2 
работает с библиотеками Oracle версии 11. Далее следующие команды необходимо 
будет исполнять через скрипт RSDU2.</P>
<P>#./configure<BR>#make<BR>#make install<BR>В процессе инсталляции будет 
запрашиваться, какой режим установки применить – выбирать полный и на все 
вопросы отвечать утвердительно. На вопрос «start waiting for oracle» для хоста 
ОИК набрать 30, а для хоста СУБД&nbsp; набрать 300 (отсчет ожидания 
автоматической загрузки модулей РСДУ2 задается в секундах).<BR>28. Исправляем 
механизмы автозагрузки ПО РВ РСДУ2<BR>* удаляем из уровней автозагрузки 
/etc/init.d/rc.3 и /etc/init.d/rc.5 скрипты запуска ema и убеждаемся, что там 
присутствует запуск скрипта ema_autoload;<BR>* убеждаемся, что в директории 
/etc/init.d/ присутствует скрипт ema_autoload.<BR>С настоящего момента скрипт 
ema выполняет только функции управления ПО РСДУ2 на хосте и не прописывается в 
автозагрузке.<BR>29. На хостах БДТИ необходимо выполнить настройку очередности 
старта/останова сервисов.<BR>3. В файле /etc/init.d/.depend.stop<BR>добавить в 
конце строки network: слово&nbsp; init.crs<BR>в конце строки raw: слово 
init.crs<BR>в конце файла строки <BR>&nbsp;&nbsp; init.crs: 
oracle<BR>&nbsp;&nbsp; oracle: ema_autoload<BR>Затем в файле 
/etc/init.d/.depend.start<BR>добавить в конце строки oracle: слово init.crs<BR>в 
конце файла добавить строки<BR>&nbsp;&nbsp; init.crs: raw 
network<BR>&nbsp;&nbsp; ema_autoload: oracle<BR>4. В YAST Runlevels отключить 
запуск демонов init.crsd, init.cssd, init.evmd на всех уровнях и оставить 
запуск&nbsp; init.crs&nbsp; на 3 и 5 уровнях. Включить автозапуск oracle на 3 и 
5-м уровнях загрузки. Также проверить - если включены уровни загрузки для ocfs2, 
то выключить на всех уровнях. <BR>5. Далее в папке /etc/init.d/rc3 выполнить в 
mc по команде Shift+F6 переименование файлов останова (префикс K) таким образом, 
чтобы последовательность останова интересующих нас сервисов была такая: ema, 
oracle, init.crs, raw, network.<BR>Затем для файлов старта процессов выполнить 
переименование файлов (с префиксом S) так, чтобы последовательность была 
обратная: network, raw, init.crs, oracle, ema.<BR>Пример:&nbsp; Результаты 
команды<BR>ls -1 /etc/init.d/rc3.d | egrep 
'crs|crsd|crss|evmd|oracle|ema|raw|network'<BR>должны быть примерно следующими 
(если не еще установлено ПО ema, то его и не будет в выводе 
команды):<BR>K01ema_autoload<BR>K07oracle<BR>К10init.crs<BR>K12raw<BR>K17network<BR>S05network<BR>S11raw<BR>S12init.crs<BR>S14oracle<BR>S99ema_autoload<BR>Здесь 
конкретные номера старта не принципиальны (например, K07oracle или K09oracle - 
не важно, главное, порядок - т.е. чтобы ema_autoload шла при останове перед 
oracle, а oracle перед init.crs и raw и т.д., а при старте, соответственно, 
наоборот). И - тут нежелательны лишние сервисы - т.е. не должно в выводе быть 
указанных еще в фильтре команды сервисов crsd,crss,evmd .<BR>Аналогичные 
действия выполнить для файлов 5 уровня в папке /etc/init.d/rc5. Аналогичными 
должны быть и результаты команды для rc5.d:<BR>ls -1 /etc/init.d/rc5.d | egrep 
'crs|crsd|crss|evmd|oracle|ema|raw|network'<BR>После этого выполнить все 
описанные&nbsp; действия на 2-м узле.<BR>30. Вносим необходимую информацию в 
конфигурационные файлы 
<BR>/etc/ema/host.ini<BR>/etc/ema/ema_time.cfg<BR>/etc/ema/ema.cfg<BR>Cодержание 
актуального конфигурационного файла host.ini взять из текущего дистрибутива, 
директория /Scripts и перенести в него настройки из текущего файла.<BR>Для 
ema_time.cfg необходимо проверить идентификаторы пользователей агента системного 
монитора USER_ID и сигнальной системы SS_USER_ID (см. через навигатор БД в 
разделе служебной информации).<BR>В ema.cfg комментируем запуск модуля bridged в 
конфигурационном файле /etc/ema/ema.cfg для того чтобы не возникло возможных 
сбоев при работе с необновленной частью комплекса. Также выставляем время между 
запуском модулей 2 секунды. Исправить также порядок старта модулей (например, 
модуль sysmond должен стартовать последним)<BR>31. Пробуем запускать модули ПО 
РСДУ2 по отдельности, с контролем лог-файлов после каждого запуска. Обращаем 
внимание на то, что некоторые ИНИ-параметры не актуальны в новой версии модулей, 
поэтому желательно исправить соответствующие настройки запускаемых приложений 
через навигатор БДТИ.<BR>ВНИМАНИЕ!!! Для запуска модулей РСДУ2 на хосте СУБД 
необходимо наличие скрипта RSDU2 и настроенного файла /etc/ema/RSDU2ENV.<BR>32. 
Выполнить reboot хоста и проконтролировать автоматическую выгрузку/загрузку 
модулей РСДУ2.<BR>33. После обновления основного и резервного хостов комплекса, 
можно раскомментировать запуск модуля bridged и проверить его работу.<BR>34. По 
завершению обновления полного состава хостов РСДУ2 собираем текущую информацию о 
запущенном ПО РВ РСДУ2 на хостах комплекса РСДУ2: лог-файлы из /var/log/ema/ и 
конфигурационные файлы из /etc/ema/ </P>
<P>&nbsp;</P></body>
</html>
